riot.tag2("ftl-include",'<div> {responseText} <div ref="dados"></div> <div ref="prog"></div> </div>',"","",(function(opts){var self=this;function scriptExecute(extrajavascript){null!=extrajavascript&&eval(extrajavascript)}self.debug=!1;const fetch=()=>{const e=new XMLHttpRequest;e.responseType="json",e.onload=t=>{200!=e.status&&(403===e.status?(alert("Desculpe, mas você não tem permissão!"),window.history.back()):500===e.status&&void 0!==e.responseURL?window.location=e.responseURL:alert("Request failed.  Returned status of "+e.status)),null!=e.response?(self.trigger("updateContent",e.response),self.trigger("loaded")):-1!==e.responseURL.indexOf("/common/login/?next=")&&(window.location=e.responseURL)},e.open("get",opts.include.url,!0),e.setRequestHeader("X-Requested-With","XMLHttpRequest");try{e.setRequestHeader("X-CSRFToken",getCookie("csrftoken")),e.setRequestHeader("HTTP_X_CSRFTOKEN",getCookie("csrftoken"))}catch{}e.send(),self.trigger("loading")};self.on("mount",()=>{self.debug&&console.log("ftl-include: mount:",opts.include.url),fetch()}),self.on("loading",()=>{self.debug&&console.log("ftl-include: loading"),document.getElementById("ftl-page-load").value="loading",opts.include.showLoading&&(document.getElementById("commonLoad").style.display="block")}),self.on("loaded",e=>{self.debug&&console.log("ftl-include: loaded"),document.getElementById("ftl-page-load").value="loaded",opts.include.showLoading&&(document.getElementById("commonLoad").style.display="none"),null!=e&&(null==e.form_errors&&null==e.formset_errors||$('input[name="save"]').show())}),self.on("updateContent",obj=>{opts.include.safe?self.refs.dados.innerHTML=obj.html:self.responseText=obj.html,scriptExecute(obj.extrajavascript),$(self.refs.dados).find('form:not([ref="modalForm"])').each((function(){$(this).attr("action",opts.include.url+(opts.include.url.endsWith("/")?"":"/")),$("<input>").attr({type:"hidden",name:"csrfmiddlewaretoken",value:getCookie("csrftoken")}).appendTo(this),$(this).submit((function(e){var submitClickedName=$(document.activeElement)[0].name,submitClickedValue=$(document.activeElement)[0].value;"checkbox"===$(document.activeElement)[0].type&&(submitClickedValue=$(document.activeElement)[0].checked),$(":disabled").removeProp("disabled"),document.activeElement.disabled=!0,$f=$(this);var type=$f.attr("method"),dados=$f.serialize()+"&"+submitClickedName+"="+submitClickedValue,url=$f.attr("action");return $.ajax({type:type,url:url,data:dados,xhrFields:{withCredentials:!0},beforeSend:function(e,t){e.setRequestHeader("X-CSRFToken",getCookie("csrftoken")),e.setRequestHeader("HTTP_X_CSRFTOKEN",getCookie("csrftoken")),self.trigger("loading")},success:function(data){return void 0!==data.redirect&&null!==data.redirect?window.location.href=data.redirect:void 0!==data.form_errors&&null!==data.form_errors||void 0!==data.formset_errors&&null!==data.formset_errors?self.trigger("updateContent",data):void 0!==data.goto?(eval(data.extrajavascript),route("/"+data.goto)):self.debug&&console.log("OK: ---\x3e"+data+"<---"),void 0!==data.msg&&(self.debug&&console.log(data.msg),riot.mount("ftl-error-message",{messages:data.msg})),self.trigger("loaded",data),!1},error:function(e,t,o){return self.debug&&console.log("Something went wrong: >"+e+"< >"+t+"< >"+o+"<"),document.open(),document.write(e.responseText),document.close(),!1}}),!1}))})),self.update()})}));