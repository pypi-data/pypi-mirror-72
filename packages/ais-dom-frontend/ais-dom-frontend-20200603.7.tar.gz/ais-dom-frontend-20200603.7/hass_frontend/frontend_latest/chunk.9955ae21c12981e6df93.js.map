{"version":3,"file":"chunk.9955ae21c12981e6df93.js","sources":["webpack:///./src/data/device_automation.ts","webpack:///./src/components/ha-dialog.ts","webpack:///./src/components/ha-chips.ts","webpack:///./src/panels/config/devices/device-detail/ha-device-automation-card.ts","webpack:///./src/panels/config/devices/device-detail/ha-device-automation-dialog.ts"],"sourcesContent":["import { computeStateName } from \"../common/entity/compute_state_name\";\nimport { HomeAssistant } from \"../types\";\n\nexport interface DeviceAutomation {\n  device_id: string;\n  domain: string;\n  entity_id: string;\n  type?: string;\n  subtype?: string;\n  event?: string;\n}\n\nexport type DeviceAction = DeviceAutomation;\n\nexport interface DeviceCondition extends DeviceAutomation {\n  condition: string;\n}\n\nexport interface DeviceTrigger extends DeviceAutomation {\n  platform: \"device\";\n}\n\nexport const fetchDeviceActions = (hass: HomeAssistant, deviceId: string) =>\n  hass.callWS<DeviceAction[]>({\n    type: \"device_automation/action/list\",\n    device_id: deviceId,\n  });\n\nexport const fetchDeviceConditions = (hass: HomeAssistant, deviceId: string) =>\n  hass.callWS<DeviceCondition[]>({\n    type: \"device_automation/condition/list\",\n    device_id: deviceId,\n  });\n\nexport const fetchDeviceTriggers = (hass: HomeAssistant, deviceId: string) =>\n  hass.callWS<DeviceTrigger[]>({\n    type: \"device_automation/trigger/list\",\n    device_id: deviceId,\n  });\n\nexport const fetchDeviceActionCapabilities = (\n  hass: HomeAssistant,\n  action: DeviceAction\n) =>\n  hass.callWS<DeviceAction[]>({\n    type: \"device_automation/action/capabilities\",\n    action,\n  });\n\nexport const fetchDeviceConditionCapabilities = (\n  hass: HomeAssistant,\n  condition: DeviceCondition\n) =>\n  hass.callWS<DeviceCondition[]>({\n    type: \"device_automation/condition/capabilities\",\n    condition,\n  });\n\nexport const fetchDeviceTriggerCapabilities = (\n  hass: HomeAssistant,\n  trigger: DeviceTrigger\n) =>\n  hass.callWS<DeviceTrigger[]>({\n    type: \"device_automation/trigger/capabilities\",\n    trigger,\n  });\n\nconst deviceAutomationIdentifiers = [\n  \"device_id\",\n  \"domain\",\n  \"entity_id\",\n  \"type\",\n  \"subtype\",\n  \"event\",\n  \"condition\",\n  \"platform\",\n];\n\nexport const deviceAutomationsEqual = (\n  a: DeviceAutomation,\n  b: DeviceAutomation\n) => {\n  if (typeof a !== typeof b) {\n    return false;\n  }\n\n  for (const property in a) {\n    if (!deviceAutomationIdentifiers.includes(property)) {\n      continue;\n    }\n    if (!Object.is(a[property], b[property])) {\n      return false;\n    }\n  }\n  for (const property in b) {\n    if (!deviceAutomationIdentifiers.includes(property)) {\n      continue;\n    }\n    if (!Object.is(a[property], b[property])) {\n      return false;\n    }\n  }\n\n  return true;\n};\n\nexport const localizeDeviceAutomationAction = (\n  hass: HomeAssistant,\n  action: DeviceAction\n): string => {\n  const state = action.entity_id ? hass.states[action.entity_id] : undefined;\n  return (\n    hass.localize(\n      `component.${action.domain}.device_automation.action_type.${action.type}`,\n      \"entity_name\",\n      state ? computeStateName(state) : action.entity_id || \"<unknown>\",\n      \"subtype\",\n      action.subtype\n        ? hass.localize(\n            `component.${action.domain}.device_automation.action_subtype.${action.subtype}`\n          ) || action.subtype\n        : \"\"\n    ) || (action.subtype ? `\"${action.subtype}\" ${action.type}` : action.type!)\n  );\n};\n\nexport const localizeDeviceAutomationCondition = (\n  hass: HomeAssistant,\n  condition: DeviceCondition\n): string => {\n  const state = condition.entity_id\n    ? hass.states[condition.entity_id]\n    : undefined;\n  return (\n    hass.localize(\n      `component.${condition.domain}.device_automation.condition_type.${condition.type}`,\n      \"entity_name\",\n      state ? computeStateName(state) : condition.entity_id || \"<unknown>\",\n      \"subtype\",\n      condition.subtype\n        ? hass.localize(\n            `component.${condition.domain}.device_automation.condition_subtype.${condition.subtype}`\n          ) || condition.subtype\n        : \"\"\n    ) ||\n    (condition.subtype\n      ? `\"${condition.subtype}\" ${condition.type}`\n      : condition.type!)\n  );\n};\n\nexport const localizeDeviceAutomationTrigger = (\n  hass: HomeAssistant,\n  trigger: DeviceTrigger\n): string => {\n  const state = trigger.entity_id ? hass.states[trigger.entity_id] : undefined;\n  return (\n    hass.localize(\n      `component.${trigger.domain}.device_automation.trigger_type.${trigger.type}`,\n      \"entity_name\",\n      state ? computeStateName(state) : trigger.entity_id || \"<unknown>\",\n      \"subtype\",\n      trigger.subtype\n        ? hass.localize(\n            `component.${trigger.domain}.device_automation.trigger_subtype.${trigger.subtype}`\n          ) || trigger.subtype\n        : \"\"\n    ) ||\n    (trigger.subtype ? `\"${trigger.subtype}\" ${trigger.type}` : trigger.type!)\n  );\n};\n","import \"@material/mwc-dialog\";\nimport type { Dialog } from \"@material/mwc-dialog\";\nimport { style } from \"@material/mwc-dialog/mwc-dialog-css\";\nimport \"./ha-icon-button\";\nimport { css, CSSResult, customElement, html } from \"lit-element\";\nimport type { Constructor, HomeAssistant } from \"../types\";\nimport { mdiClose } from \"@mdi/js\";\n\nconst MwcDialog = customElements.get(\"mwc-dialog\") as Constructor<Dialog>;\n\nexport const createCloseHeading = (hass: HomeAssistant, title: string) => html`\n  ${title}\n  <mwc-icon-button\n    aria-label=${hass.localize(\"ui.dialogs.generic.close\")}\n    dialogAction=\"close\"\n    class=\"close_button\"\n  >\n    <ha-svg-icon path=${mdiClose}></ha-svg-icon>\n  </mwc-icon-button>\n`;\n\n@customElement(\"ha-dialog\")\nexport class HaDialog extends MwcDialog {\n  protected static get styles(): CSSResult[] {\n    return [\n      style,\n      css`\n        .mdc-dialog__actions {\n          justify-content: var(--justify-action-buttons, flex-end);\n        }\n        .mdc-dialog__container {\n          align-items: var(--vertial-align-dialog, center);\n        }\n        .mdc-dialog__title::before {\n          display: block;\n          height: 20px;\n        }\n        .close_button {\n          position: absolute;\n          right: 16px;\n          top: 12px;\n        }\n      `,\n    ];\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-dialog\": HaDialog;\n  }\n}\n","// @ts-ignore\nimport chipStyles from \"@material/chips/dist/mdc.chips.min.css\";\nimport { ripple } from \"@material/mwc-ripple/ripple-directive\";\nimport {\n  css,\n  CSSResult,\n  customElement,\n  html,\n  LitElement,\n  property,\n  TemplateResult,\n  unsafeCSS,\n} from \"lit-element\";\nimport { fireEvent } from \"../common/dom/fire_event\";\n\ndeclare global {\n  // for fire event\n  interface HASSDomEvents {\n    \"chip-clicked\": { index: string };\n  }\n}\n\n@customElement(\"ha-chips\")\nexport class HaChips extends LitElement {\n  @property() public items = [];\n\n  protected render(): TemplateResult {\n    if (this.items.length === 0) {\n      return html``;\n    }\n    return html`\n      <div class=\"mdc-chip-set\">\n        ${this.items.map(\n          (item, idx) =>\n            html`\n              <div class=\"mdc-chip\" .index=${idx} @click=${this._handleClick}>\n                <div class=\"mdc-chip__ripple\" .ripple=\"${ripple()}\"></div>\n                <span role=\"gridcell\">\n                  <span\n                    role=\"button\"\n                    tabindex=\"0\"\n                    class=\"mdc-chip__primary-action\"\n                  >\n                    <span class=\"mdc-chip__text\">${item}</span>\n                  </span>\n                </span>\n              </div>\n            `\n        )}\n      </div>\n    `;\n  }\n\n  private _handleClick(ev): void {\n    fireEvent(this, \"chip-clicked\", {\n      index: ev.currentTarget.index,\n    });\n  }\n\n  static get styles(): CSSResult {\n    return css`\n      ${unsafeCSS(chipStyles)}\n      .mdc-chip {\n        background-color: rgba(var(--rgb-primary-text-color), 0.15);\n        color: var(--primary-text-color);\n      }\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-chips\": HaChips;\n  }\n}\n","import {\n  css,\n  CSSResult,\n  html,\n  LitElement,\n  property,\n  TemplateResult,\n} from \"lit-element\";\nimport \"../../../../components/ha-card\";\nimport \"../../../../components/ha-chips\";\nimport { showAutomationEditor } from \"../../../../data/automation\";\nimport { DeviceAutomation } from \"../../../../data/device_automation\";\nimport { showScriptEditor } from \"../../../../data/script\";\nimport { HomeAssistant } from \"../../../../types\";\n\nexport abstract class HaDeviceAutomationCard<\n  T extends DeviceAutomation\n> extends LitElement {\n  @property() public hass!: HomeAssistant;\n\n  @property() public deviceId?: string;\n\n  @property() public script = false;\n\n  @property() public automations: T[] = [];\n\n  protected headerKey = \"\";\n\n  protected type = \"\";\n\n  private _localizeDeviceAutomation: (\n    hass: HomeAssistant,\n    automation: T\n  ) => string;\n\n  constructor(\n    localizeDeviceAutomation: HaDeviceAutomationCard<\n      T\n    >[\"_localizeDeviceAutomation\"]\n  ) {\n    super();\n    this._localizeDeviceAutomation = localizeDeviceAutomation;\n  }\n\n  protected shouldUpdate(changedProps): boolean {\n    if (changedProps.has(\"deviceId\") || changedProps.has(\"automations\")) {\n      return true;\n    }\n    const oldHass = changedProps.get(\"hass\");\n    if (!oldHass || this.hass.language !== oldHass.language) {\n      return true;\n    }\n    return false;\n  }\n\n  protected render(): TemplateResult {\n    if (this.automations.length === 0) {\n      return html``;\n    }\n    return html`\n      <h3>\n        ${this.hass.localize(this.headerKey)}\n      </h3>\n      <div class=\"content\">\n        <ha-chips\n          @chip-clicked=${this._handleAutomationClicked}\n          .items=${this.automations.map((automation) =>\n            this._localizeDeviceAutomation(this.hass, automation)\n          )}\n        >\n        </ha-chips>\n      </div>\n    `;\n  }\n\n  private _handleAutomationClicked(ev: CustomEvent) {\n    const automation = this.automations[ev.detail.index];\n    if (!automation) {\n      return;\n    }\n    if (this.script) {\n      showScriptEditor(this, { sequence: [automation] });\n      return;\n    }\n    const data = {};\n    data[this.type] = [automation];\n    showAutomationEditor(this, data);\n  }\n\n  static get styles(): CSSResult {\n    return css`\n      h3 {\n        color: var(--primary-text-color);\n      }\n    `;\n  }\n}\n","import {\n  CSSResult,\n  customElement,\n  html,\n  LitElement,\n  property,\n  TemplateResult,\n} from \"lit-element\";\nimport \"../../../../components/ha-dialog\";\nimport {\n  DeviceAction,\n  DeviceCondition,\n  DeviceTrigger,\n  fetchDeviceActions,\n  fetchDeviceConditions,\n  fetchDeviceTriggers,\n} from \"../../../../data/device_automation\";\nimport { haStyleDialog } from \"../../../../resources/styles\";\nimport { HomeAssistant } from \"../../../../types\";\nimport \"./ha-device-actions-card\";\nimport \"./ha-device-conditions-card\";\nimport \"./ha-device-triggers-card\";\nimport { DeviceAutomationDialogParams } from \"./show-dialog-device-automation\";\n\n@customElement(\"dialog-device-automation\")\nexport class DialogDeviceAutomation extends LitElement {\n  @property() public hass!: HomeAssistant;\n\n  @property() private _triggers: DeviceTrigger[] = [];\n\n  @property() private _conditions: DeviceCondition[] = [];\n\n  @property() private _actions: DeviceAction[] = [];\n\n  @property() private _params?: DeviceAutomationDialogParams;\n\n  public async showDialog(params: DeviceAutomationDialogParams): Promise<void> {\n    this._params = params;\n    await this.updateComplete;\n  }\n\n  protected firstUpdated(changedProps) {\n    super.firstUpdated(changedProps);\n    this.hass.loadBackendTranslation(\"device_automation\");\n  }\n\n  protected updated(changedProps): void {\n    super.updated(changedProps);\n\n    if (!changedProps.has(\"_params\")) {\n      return;\n    }\n\n    this._triggers = [];\n    this._conditions = [];\n    this._actions = [];\n\n    if (!this._params) {\n      return;\n    }\n\n    const { deviceId, script } = this._params;\n\n    fetchDeviceActions(this.hass, deviceId).then((actions) => {\n      this._actions = actions;\n    });\n    if (script) {\n      return;\n    }\n    fetchDeviceTriggers(this.hass, deviceId).then((triggers) => {\n      this._triggers = triggers;\n    });\n    fetchDeviceConditions(this.hass, deviceId).then((conditions) => {\n      this._conditions = conditions;\n    });\n  }\n\n  protected render(): TemplateResult | void {\n    if (!this._params) {\n      return html``;\n    }\n\n    return html`\n      <ha-dialog\n        open\n        @closing=\"${this._close}\"\n        .heading=${this.hass.localize(\n          `ui.panel.config.devices.${\n            this._params.script ? \"script\" : \"automation\"\n          }.create`\n        )}\n      >\n        <div @chip-clicked=${this._close}>\n          ${this._triggers.length ||\n          this._conditions.length ||\n          this._actions.length\n            ? html`\n                ${this._triggers.length\n                  ? html`\n                      <ha-device-triggers-card\n                        .hass=${this.hass}\n                        .automations=${this._triggers}\n                      ></ha-device-triggers-card>\n                    `\n                  : \"\"}\n                ${this._conditions.length\n                  ? html`\n                      <ha-device-conditions-card\n                        .hass=${this.hass}\n                        .automations=${this._conditions}\n                      ></ha-device-conditions-card>\n                    `\n                  : \"\"}\n                ${this._actions.length\n                  ? html`\n                      <ha-device-actions-card\n                        .hass=${this.hass}\n                        .automations=${this._actions}\n                        .script=${this._params.script}\n                      ></ha-device-actions-card>\n                    `\n                  : \"\"}\n              `\n            : this.hass.localize(\n                \"ui.panel.config.devices.automation.no_device_automations\"\n              )}\n        </div>\n        <mwc-button slot=\"primaryAction\" @click=\"${this._close}\">\n          Close\n        </mwc-button>\n      </ha-dialog>\n    `;\n  }\n\n  private _close(): void {\n    this._params = undefined;\n  }\n\n  static get styles(): CSSResult {\n    return haStyleDialog;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"dialog-device-automation\": DialogDeviceAutomation;\n  }\n}\n"],"mappings":"AAAA;ACWA;;AAEA;;;;AAIA;;AAKA;;;;;;;;;;;;;;;;AAAA;;ACUA;AAGA;AACA;;;;;;;AAOA;;;;;;AApBA;AAsCA;;;;;AAtCA;;ACsCA;;;;AAIA;AACA;;;;AAnDA;;;;AAEA;;;ACoEA;AACA;;AAMA;AACA;AAIA;;AAGA;AACA;;AAGA;AACA;;AAGA;AACA;;AAGA;AACA;;AAGA;AACA;AACA;;AAGA;AAEA;;AAIA;;;;AAhDA","sourceRoot":""}