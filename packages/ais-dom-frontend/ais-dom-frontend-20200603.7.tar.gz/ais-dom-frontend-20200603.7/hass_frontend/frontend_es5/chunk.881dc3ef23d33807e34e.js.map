{"version":3,"file":"chunk.881dc3ef23d33807e34e.js","sources":["webpack:///./src/mixins/subscribe-mixin.ts"],"sourcesContent":["import { UnsubscribeFunc } from \"home-assistant-js-websocket\";\nimport { property, PropertyValues, UpdatingElement } from \"lit-element\";\nimport { Constructor, HomeAssistant } from \"../types\";\n\nexport interface HassSubscribeElement {\n  hassSubscribe(): UnsubscribeFunc[];\n}\n\nexport const SubscribeMixin = <T extends Constructor<UpdatingElement>>(\n  superClass: T\n) => {\n  class SubscribeClass extends superClass {\n    @property() public hass?: HomeAssistant;\n\n    private __unsubs?: Array<UnsubscribeFunc | Promise<UnsubscribeFunc>>;\n\n    public connectedCallback() {\n      super.connectedCallback();\n      this.__checkSubscribed();\n    }\n\n    public disconnectedCallback() {\n      super.disconnectedCallback();\n      if (this.__unsubs) {\n        while (this.__unsubs.length) {\n          const unsub = this.__unsubs.pop()!;\n          if (unsub instanceof Promise) {\n            unsub.then((unsubFunc) => unsubFunc());\n          } else {\n            unsub();\n          }\n        }\n        this.__unsubs = undefined;\n      }\n    }\n\n    protected updated(changedProps: PropertyValues) {\n      super.updated(changedProps);\n      if (changedProps.has(\"hass\")) {\n        this.__checkSubscribed();\n      }\n    }\n\n    protected hassSubscribe(): Array<\n      UnsubscribeFunc | Promise<UnsubscribeFunc>\n    > {\n      return [];\n    }\n\n    private __checkSubscribed(): void {\n      if (\n        this.__unsubs !== undefined ||\n        !((this as unknown) as Element).isConnected ||\n        this.hass === undefined\n      ) {\n        return;\n      }\n      this.__unsubs = this.hassSubscribe();\n    }\n  }\n  return SubscribeClass;\n};\n"],"mappings":"AAQA","sourceRoot":""}