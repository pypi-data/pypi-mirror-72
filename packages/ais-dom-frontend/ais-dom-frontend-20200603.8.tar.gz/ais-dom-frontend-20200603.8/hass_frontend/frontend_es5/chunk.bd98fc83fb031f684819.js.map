{"version":3,"file":"chunk.bd98fc83fb031f684819.js","sources":["webpack:///./src/panels/lovelace/cards/hui-ais-auto-entities-card.js"],"sourcesContent":["!(function(t) {\n  var e = {};\n  function i(s) {\n    if (e[s]) return e[s].exports;\n    var r = (e[s] = { i: s, l: !1, exports: {} });\n    return t[s].call(r.exports, r, r.exports, i), (r.l = !0), r.exports;\n  }\n  (i.m = t),\n    (i.c = e),\n    (i.d = function(t, e, s) {\n      i.o(t, e) || Object.defineProperty(t, e, { enumerable: !0, get: s });\n    }),\n    (i.r = function(t) {\n      \"undefined\" != typeof Symbol &&\n        Symbol.toStringTag &&\n        Object.defineProperty(t, Symbol.toStringTag, { value: \"Module\" }),\n        Object.defineProperty(t, \"__esModule\", { value: !0 });\n    }),\n    (i.t = function(t, e) {\n      if ((1 & e && (t = i(t)), 8 & e)) return t;\n      if (4 & e && \"object\" == typeof t && t && t.__esModule) return t;\n      var s = Object.create(null);\n      if (\n        (i.r(s),\n        Object.defineProperty(s, \"default\", { enumerable: !0, value: t }),\n        2 & e && \"string\" != typeof t)\n      )\n        for (var r in t)\n          i.d(\n            s,\n            r,\n            function(e) {\n              return t[e];\n            }.bind(null, r)\n          );\n      return s;\n    }),\n    (i.n = function(t) {\n      var e =\n        t && t.__esModule\n          ? function() {\n              return t.default;\n            }\n          : function() {\n              return t;\n            };\n      return i.d(e, \"a\", e), e;\n    }),\n    (i.o = function(t, e) {\n      return Object.prototype.hasOwnProperty.call(t, e);\n    }),\n    (i.p = \"\"),\n    i((i.s = 0));\n})([\n  function(t, e, i) {\n    \"use strict\";\n    i.r(e);\n    const s = customElements.get(\"home-assistant-main\")\n        ? Object.getPrototypeOf(customElements.get(\"home-assistant-main\"))\n        : Object.getPrototypeOf(customElements.get(\"hui-view\")),\n      r = s.prototype.html;\n    s.prototype.css;\n    function n() {\n      return document.querySelector(\"home-assistant\").hass;\n    }\n    const o = n().callWS({ type: \"config/area_registry/list\" }),\n      a = n().callWS({ type: \"config/device_registry/list\" }),\n      c = n().callWS({ type: \"config/entity_registry/list\" });\n    async function u() {\n      return (\n        (window.cardToolsData = window.cardToolsData || {\n          areas: await o,\n          devices: await a,\n          entities: await c,\n        }),\n        window.cardToolsData\n      );\n    }\n    function f(t) {\n      const e = window.cardToolsData;\n      let i = [];\n      if (!t) return i;\n      for (const s of e.devices) s.area_id === t.area_id && i.push(s);\n      return i;\n    }\n    function l(t) {\n      const e = window.cardToolsData;\n      let i = [];\n      if (!t) return i;\n      for (const s of e.entities) s.device_id === t.id && i.push(s.entity_id);\n      return i;\n    }\n    function d(t, e) {\n      if (\n        \"string\" == typeof e &&\n        \"string\" == typeof t &&\n        ((t.startsWith(\"/\") && t.endsWith(\"/\")) || -1 !== t.indexOf(\"*\"))\n      ) {\n        return (\n          t.startsWith(\"/\") ||\n            (t = `/^${(t = t.replace(/\\./g, \".\").replace(/\\*/g, \".*\"))}$/`),\n          new RegExp(t.slice(1, -1)).test(e)\n        );\n      }\n      if (\"string\" == typeof t) {\n        if (t.startsWith(\"<=\")) return parseFloat(e) <= parseFloat(t.substr(2));\n        if (t.startsWith(\">=\")) return parseFloat(e) >= parseFloat(t.substr(2));\n        if (t.startsWith(\"<\")) return parseFloat(e) < parseFloat(t.substr(1));\n        if (t.startsWith(\">\")) return parseFloat(e) > parseFloat(t.substr(1));\n        if (t.startsWith(\"!\")) return parseFloat(e) != parseFloat(t.substr(1));\n        if (t.startsWith(\"=\")) return parseFloat(e) == parseFloat(t.substr(1));\n      }\n      return t === e;\n    }\n    function h(t, e) {\n      return function(i) {\n        const s = \"string\" == typeof i ? t.states[i] : t.states[i.entity];\n        if (!i) return !1;\n        for (const [r, n] of Object.entries(e))\n          switch (r.split(\" \")[0]) {\n            case \"options\":\n            case \"sort\":\n              break;\n            case \"domain\":\n              if (!d(n, s.entity_id.split(\".\")[0])) return !1;\n              break;\n            case \"entity_id\":\n              if (!d(n, s.entity_id)) return !1;\n              break;\n            case \"state\":\n              if (!d(n, s.state)) return !1;\n              break;\n            case \"name\":\n              if (\n                !s.attributes.friendly_name ||\n                !d(n, s.attributes.friendly_name)\n              )\n                return !1;\n              break;\n            case \"group\":\n              if (\n                !(\n                  n.startsWith(\"group.\") &&\n                  t.states[n] &&\n                  t.states[n].attributes.entity_id &&\n                  t.states[n].attributes.entity_id.includes(s.entity_id)\n                )\n              )\n                return !1;\n              break;\n            case \"attributes\":\n              for (const [t, e] of Object.entries(n)) {\n                let i = t.split(\" \")[0],\n                  r = s.attributes;\n                for (; i && r; ) {\n                  let t;\n                  ([t, i] = i.split(\":\")), (r = r[t]);\n                }\n                if (void 0 === r || (e && !d(e, r))) return !1;\n              }\n              break;\n            case \"not\":\n              if (h(t, n)(i)) return !1;\n              break;\n            case \"device\":\n              if (!window.cardToolsData || !window.cardToolsData.devices)\n                return !1;\n              let e = !1;\n              for (const t of window.cardToolsData.devices)\n                d(n, t.name) && l(t).includes(s.entity_id) && (e = !0);\n              if (!e) return !1;\n              break;\n            case \"area\":\n              if (!window.cardToolsData || !window.cardToolsData.areas)\n                return !1;\n              let r = !1;\n              for (const t of window.cardToolsData.areas)\n                d(n, t.name) &&\n                  f(t)\n                    .flatMap(l)\n                    .includes(s.entity_id) &&\n                  (r = !0);\n              if (!r) return !1;\n              break;\n            default:\n              return !1;\n          }\n        return !0;\n      };\n    }\n    function y(t, e) {\n      return (\n        \"string\" == typeof e && (e = { method: e }),\n        function(i, s) {\n          const r = \"string\" == typeof i ? t.states[i] : t.states[i.entity],\n            n = \"string\" == typeof s ? t.states[s] : t.states[s.entity];\n          if (void 0 === r || void 0 === n) return 0;\n          const [o, a] = e.reverse ? [-1, 1] : [1, -1];\n          function c(t, i) {\n            return (\n              e.ignore_case && t.toLowerCase && (t = t.toLowerCase()),\n              e.ignore_case && i.toLowerCase && (i = i.toLowerCase()),\n              void 0 === t && void 0 === i\n                ? 0\n                : void 0 === t\n                ? o\n                : void 0 === i\n                ? a\n                : t < i\n                ? a\n                : t > i\n                ? o\n                : 0\n            );\n          }\n          switch (e.method) {\n            case \"domain\":\n              return c(r.entity_id.split(\".\")[0], n.entity_id.split(\".\")[0]);\n            case \"entity_id\":\n              return c(r.entity_id, n.entity_id);\n            case \"friendly_name\":\n            case \"name\":\n              return c(\n                r.attributes.friendly_name || r.entity_id.split(\".\")[1],\n                n.attributes.friendly_name || n.entity_id.split(\".\")[1]\n              );\n            case \"state\":\n              return c(r.state, n.state);\n            case \"attribute\":\n              let t = r.attributes,\n                i = n.attributes,\n                s = e.attribute;\n              for (; s; ) {\n                let e;\n                if (\n                  (([e, s] = s.split(\":\")),\n                  (t = t[e]),\n                  (i = i[e]),\n                  void 0 === t && void 0 === i)\n                )\n                  return 0;\n                if (void 0 === t) return o;\n                if (void 0 === i) return a;\n              }\n              return c(t, i);\n            default:\n              return 0;\n          }\n        }\n      );\n    }\n    function p(t, e, i = null) {\n      if (\n        (((t = new Event(t, {\n          bubbles: !0,\n          cancelable: !1,\n          composed: !0,\n        })).detail = e || {}),\n        i)\n      )\n        i.dispatchEvent(t);\n      else {\n        var s = document.querySelector(\"home-assistant\");\n        (s =\n          (s =\n            (s =\n              (s =\n                (s =\n                  (s =\n                    (s =\n                      ((s =\n                        (s =\n                          (s =\n                            (s = s && s.shadowRoot) &&\n                            s.querySelector(\"home-assistant-main\")) &&\n                          s.shadowRoot) &&\n                        s.querySelector(\n                          \"app-drawer-layout partial-panel-resolver\"\n                        )) &&\n                        s.shadowRoot) ||\n                      s) && s.querySelector(\"ha-panel-lovelace\")) &&\n                  s.shadowRoot) && s.querySelector(\"hui-root\")) &&\n              s.shadowRoot) && s.querySelector(\"ha-app-layout #view\")) &&\n          s.firstElementChild) && s.dispatchEvent(t);\n      }\n    }\n    u();\n    const g = \"custom:\";\n    function _(t, e) {\n      const i = document.createElement(\"hui-error-card\");\n      return i.setConfig({ type: \"error\", error: t, origConfig: e }), i;\n    }\n    function m(t, e) {\n      if (!e || \"object\" != typeof e || !e.type)\n        return _(`No ${t} type configured`, e);\n      let i = e.type;\n      if (\n        ((i = i.startsWith(g) ? i.substr(g.length) : `hui-${i}-${t}`),\n        customElements.get(i))\n      )\n        return (function(t, e) {\n          const i = document.createElement(t);\n          try {\n            i.setConfig(e);\n          } catch (t) {\n            return _(t, e);\n          }\n          return i;\n        })(i, e);\n      const s = _(`Custom element doesn't exist: ${i}.`, e);\n      s.style.display = \"None\";\n      const r = setTimeout(() => {\n        s.style.display = \"\";\n      }, 2e3);\n      return (\n        customElements.whenDefined(i).then(() => {\n          clearTimeout(r), p(\"ll-rebuild\", {}, s);\n        }),\n        s\n      );\n    }\n    customElements.define(\n      \"hui-ais-auto-entities-card\",\n      class extends s {\n        static get properties() {\n          return { hass: {} };\n        }\n        setConfig(t) {\n          if (!t || !t.card) throw new Error(\"Invalid configuration\");\n          this._config\n            ? ((this._config = t), (this.hass = this.hass))\n            : ((this._config = t),\n              (this.hass = n()),\n              this._getEntities(),\n              (this.cardConfig = { entities: this.entities, ...t.card }),\n              (this.card = (function(t) {\n                return m(\"card\", t);\n              })(this.cardConfig))),\n            u().then(() => this._getEntities());\n        }\n        _getEntities() {\n          let t = [];\n          if (\n            (this._config.entities &&\n              (t = t\n                .concat(this._config.entities)\n                .map((t) => (\"string\" == typeof t ? { entity: t } : t))),\n            !this.hass || !this._config.filter)\n          )\n            return t;\n          if (this._config.filter.include) {\n            const e = Object.keys(this.hass.states).map(\n              (t) => new Object({ entity: t })\n            );\n            for (const i of this._config.filter.include) {\n              if (void 0 !== i.type) {\n                t.push(i);\n                continue;\n              }\n              let s = e\n                .filter(h(this.hass, i))\n                .map((t) => new Object({ ...t, ...i.options }));\n              void 0 !== i.sort && (s = s.sort(y(this.hass, i.sort))),\n                (t = t.concat(s));\n            }\n          }\n          if (this._config.filter.exclude)\n            for (const e of this._config.filter.exclude)\n              t = t.filter(\n                (t) =>\n                  (\"string\" != typeof t && void 0 === t.entity) ||\n                  !h(this.hass, e)(t)\n              );\n          if (\n            this._config.sort &&\n            ((t = t.sort(y(this.hass, this._config.sort))),\n            this._config.sort.count)\n          ) {\n            const e = this._config.sort.first || 0;\n            t = t.slice(e, e + this._config.sort.count);\n          }\n          if (this._config.unique) {\n            function e(t, i) {\n              return (\n                typeof t == typeof i &&\n                (\"object\" != typeof t\n                  ? t === i\n                  : !Object.keys(t).some((t) => !Object.keys(i).includes(t)) &&\n                    Object.keys(t).every((s) => e(t[s], i[s])))\n              );\n            }\n            let i = [];\n            for (const s of t) i.some((t) => e(t, s)) || i.push(s);\n            t = i;\n          }\n          this.entities = t;\n        }\n        set entities(t) {\n          (function(t, e) {\n            if (t === e) return !0;\n            if (null == t || null == e) return !1;\n            if (t.length != e.length) return !1;\n            for (var i = 0; i < t.length; i++)\n              if (JSON.stringify(t[i]) !== JSON.stringify(e[i])) return !1;\n            return !0;\n          })(t, this._entities) ||\n            ((this._entities = t),\n            (this.cardConfig = {\n              ...this.cardConfig,\n              entities: this._entities,\n            }),\n            0 === t.length && !1 === this._config.show_empty\n              ? ((this.style.display = \"none\"), (this.style.margin = \"0\"))\n              : ((this.style.display = null), (this.style.margin = null)));\n        }\n        get entities() {\n          return this._entities;\n        }\n        set cardConfig(t) {\n          (this._cardConfig = t), this.card && this.card.setConfig(t);\n        }\n        get cardConfig() {\n          return this._cardConfig;\n        }\n        updated(t) {\n          t.has(\"hass\") &&\n            this.hass &&\n            ((this.card.hass = this.hass),\n            setTimeout(() => this._getEntities(), 0));\n        }\n        createRenderRoot() {\n          return this;\n        }\n        render() {\n          return r`\n    ${this.card}`;\n        }\n        getCardSize() {\n          let t = 0;\n          return (\n            this.card && this.card.getCardSize && (t = this.card.getCardSize()),\n            1 === t && this.entities.length && (t = this.entities.length),\n            0 === t &&\n              this._config.filter &&\n              this._config.filter.include &&\n              (t = Object.keys(this._config.filter.include).length),\n            t || 1\n          );\n        }\n      }\n    ),\n      p(\"ll-rebuild\", {});\n  },\n]);\n"],"mappings":"AAAA","sourceRoot":""}