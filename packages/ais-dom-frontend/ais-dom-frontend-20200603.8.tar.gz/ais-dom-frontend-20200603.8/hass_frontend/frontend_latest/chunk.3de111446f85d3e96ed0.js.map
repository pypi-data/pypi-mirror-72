{"version":3,"file":"chunk.3de111446f85d3e96ed0.js","sources":["webpack:///./src/data/graph.ts","webpack:///./src/panels/lovelace/components/hui-graph-base.ts","webpack:///./src/panels/lovelace/header-footer/hui-graph-header-footer.ts"],"sourcesContent":["export const strokeWidth = 5;\n","import {\n  css,\n  CSSResult,\n  customElement,\n  html,\n  LitElement,\n  property,\n  PropertyValues,\n  svg,\n  TemplateResult,\n} from \"lit-element\";\nimport { strokeWidth } from \"../../../data/graph\";\nimport { getPath } from \"../common/graph/get-path\";\n\n@customElement(\"hui-graph-base\")\nexport class HuiGraphBase extends LitElement {\n  @property() public coordinates?: any;\n\n  @property() private _path?: string;\n\n  protected render(): TemplateResult {\n    return html`\n      ${this._path\n        ? svg`<svg width=\"100%\" height=\"100%\" viewBox=\"0 0 500 100\">\n          <g>\n            <mask id=\"fill\">\n              <path\n                class='fill'\n                fill='white'\n                d=\"${this._path} L 500, 100 L 0, 100 z\"\n              />\n            </mask>\n            <rect height=\"100%\" width=\"100%\" id=\"fill-rect\" fill=\"var(--accent-color)\" mask=\"url(#fill)\"></rect>\n            <mask id=\"line\">\n              <path\n                fill=\"none\"\n                stroke=\"var(--accent-color)\"\n                stroke-width=\"${strokeWidth}\"\n                stroke-linecap=\"round\"\n                stroke-linejoin=\"round\"\n                d=${this._path}\n              ></path>\n            </mask>\n            <rect height=\"100%\" width=\"100%\" id=\"rect\" fill=\"var(--accent-color)\" mask=\"url(#line)\"></rect>\n          </g>\n        </svg>`\n        : svg`<svg width=\"100%\" height=\"100%\" viewBox=\"0 0 500 100\"></svg>`}\n    `;\n  }\n\n  protected updated(changedProps: PropertyValues) {\n    if (!this.coordinates) {\n      return;\n    }\n\n    if (changedProps.has(\"coordinates\")) {\n      this._path = getPath(this.coordinates);\n    }\n  }\n\n  static get styles(): CSSResult {\n    return css`\n      :host {\n        display: flex;\n        width: 100%;\n      }\n      .fill {\n        opacity: 0.1;\n      }\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"hui-graph-base\": HuiGraphBase;\n  }\n}\n","import \"@polymer/paper-spinner/paper-spinner\";\nimport { HassEntity } from \"home-assistant-js-websocket\";\nimport {\n  css,\n  CSSResult,\n  customElement,\n  html,\n  LitElement,\n  property,\n  PropertyValues,\n  TemplateResult,\n} from \"lit-element\";\nimport { fetchRecent } from \"../../../data/history\";\nimport { HomeAssistant } from \"../../../types\";\nimport { coordinates } from \"../common/graph/coordinates\";\nimport { hasConfigOrEntityChanged } from \"../common/has-changed\";\nimport \"../components/hui-graph-base\";\nimport { LovelaceHeaderFooter } from \"../types\";\nimport { GraphHeaderFooterConfig } from \"./types\";\n\nconst MINUTE = 60000;\nconst DAY = 86400000;\n\n@customElement(\"hui-graph-header-footer\")\nexport class HuiGraphHeaderFooter extends LitElement\n  implements LovelaceHeaderFooter {\n  public static getStubConfig(): object {\n    return {};\n  }\n\n  @property() public hass?: HomeAssistant;\n\n  @property() protected _config?: GraphHeaderFooterConfig;\n\n  @property() private _coordinates?: number[][];\n\n  private _date?: Date;\n\n  private _stateHistory?: HassEntity[];\n\n  private _fetching = false;\n\n  public getCardSize(): number {\n    return 2;\n  }\n\n  public setConfig(config: GraphHeaderFooterConfig): void {\n    if (!config?.entity || config.entity.split(\".\")[0] !== \"sensor\") {\n      throw new Error(\n        \"Invalid Configuration: An entity from within the sensor domain required\"\n      );\n    }\n\n    const cardConfig = {\n      detail: 1,\n      hours_to_show: 24,\n      ...config,\n    };\n\n    cardConfig.hours_to_show = Number(cardConfig.hours_to_show);\n    cardConfig.detail =\n      cardConfig.detail === 1 || cardConfig.detail === 2\n        ? cardConfig.detail\n        : 1;\n\n    this._config = cardConfig;\n  }\n\n  protected render(): TemplateResult {\n    if (!this._config || !this.hass) {\n      return html``;\n    }\n\n    if (!this._coordinates) {\n      return html`\n        <div class=\"container\">\n          <paper-spinner active></paper-spinner>\n        </div>\n      `;\n    }\n\n    if (!this._coordinates.length) {\n      return html`\n        <div class=\"container\">\n          <div class=\"info\">\n            No state history found.\n          </div>\n        </div>\n      `;\n    }\n\n    return html`\n      <hui-graph-base .coordinates=${this._coordinates}></hui-graph-base>\n    `;\n  }\n\n  protected shouldUpdate(changedProps: PropertyValues): boolean {\n    return hasConfigOrEntityChanged(this, changedProps);\n  }\n\n  protected updated(changedProps: PropertyValues) {\n    if (\n      !this._config ||\n      !this.hass ||\n      (this._fetching && !changedProps.has(\"_config\"))\n    ) {\n      return;\n    }\n\n    if (changedProps.has(\"_config\")) {\n      const oldConfig = changedProps.get(\"_config\") as GraphHeaderFooterConfig;\n      if (!oldConfig || oldConfig.entity !== this._config.entity) {\n        this._stateHistory = [];\n      }\n\n      this._getCoordinates();\n    } else if (Date.now() - this._date!.getTime() >= MINUTE) {\n      this._getCoordinates();\n    }\n  }\n\n  private async _getCoordinates(): Promise<void> {\n    this._fetching = true;\n    const endTime = new Date();\n    const startTime =\n      !this._date || !this._stateHistory?.length\n        ? new Date(\n            new Date().setHours(\n              endTime.getHours() - this._config!.hours_to_show!\n            )\n          )\n        : this._date;\n\n    if (this._stateHistory!.length) {\n      this._stateHistory = this._stateHistory!.filter(\n        (entity) =>\n          endTime.getTime() - new Date(entity.last_changed).getTime() <= DAY\n      );\n    }\n\n    const stateHistory = await fetchRecent(\n      this.hass!,\n      this._config!.entity,\n      startTime,\n      endTime,\n      Boolean(this._stateHistory!.length)\n    );\n\n    if (stateHistory.length && stateHistory[0].length) {\n      this._stateHistory!.push(...stateHistory[0]);\n    }\n\n    this._coordinates =\n      coordinates(\n        this._stateHistory,\n        this._config!.hours_to_show!,\n        500,\n        this._config!.detail!\n      ) || [];\n\n    this._date = endTime;\n    this._fetching = false;\n  }\n\n  static get styles(): CSSResult {\n    return css`\n      paper-spinner {\n        position: absolute;\n        top: calc(50% - 28px);\n      }\n      .container {\n        display: flex;\n        justify-content: center;\n        position: relative;\n        padding-bottom: 20%;\n      }\n      .info {\n        position: absolute;\n        top: calc(50% - 16px);\n        color: var(--secondary-text-color);\n      }\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"hui-graph-header-footer\": HuiGraphHeaderFooter;\n  }\n}\n"],"mappings":"AAAA;ACsBA;;;;;;AAOA;;;;;;;;AD7BA;;;ACwCA;;;;;AAMA;AA/BA;;;;;;;;AAAA;AC6EA;AAVA;;;;;;AARA;;;;AAJA;;;;;;;;;;;;;;;;AA9CA","sourceRoot":""}