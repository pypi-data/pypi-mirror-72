!function(){function e(){}function t(){}function a(e,t){this._loggers={},this.name=e||"",this._parent=t||null,t||(this._enabled=!0,this._level=c.WARN)}function i(){return n}function o(e){n=e}Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),a=this,i=function(){},o=function(){return a.apply(this instanceof i&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return i.prototype=this.prototype,o.prototype=new i,o});var s,n,c={DEBUG:10,INFO:20,WARN:30,ERROR:40,FATAL:50};e.prototype={output:function(e,t,a){if(void 0!==window.console&&void 0!==console.log){e&&a.unshift(e+":");var i=a.join(" ");if(void 0===typeof console.info){var o;o=t<=c.DEBUG?"DEBUG":t<=c.INFO?"INFO":t<=c.WARN?"WARN":t<=c.ERROR?"ERROR":"FATAL",console.log("["+o+"] "+i)}else t<=c.DEBUG?(i="[DEBUG] "+i,console.log(i)):t<=c.INFO?console.info(i):t<=c.WARN?console.warn(i):console.error(i)}}},t.prototype={output:function(e,t,a){e&&a.unshift(e+":"),t<=c.DEBUG?(a.unshift("[DEBUG]"),console.log.apply(console,a)):t<=c.INFO?console.info.apply(console,a):t<=c.WARN?console.warn.apply(console,a):console.error.apply(console,a)}},a.prototype={getLogger:function(e){for(var t=e.split("."),i=this,o=this.name?[this.name]:[];t.length;){var s=t.shift();o.push(s),s in i._loggers||(i._loggers[s]=new a(o.join("."),i)),i=i._loggers[s]}return i},_getFlag:function(e){var t=this;for(e="_"+e;null!==t;){if(void 0!==t[e])return t[e];t=t._parent}return null},setEnabled:function(e){this._enabled=!!e},isEnabled:function(){this._getFlag("enabled")},setLevel:function(e){"number"==typeof e?this._level=e:"string"==typeof e&&(e=e.toUpperCase())in c&&(this._level=c[e])},getLevel:function(){return this._getFlag("level")},log:function(e,t){!t.length||!this._getFlag("enabled")||e<this._getFlag("level")||(t=Array.prototype.slice.call(t),n.output(this.name,e,t))},debug:function(){this.log(c.DEBUG,arguments)},info:function(){this.log(c.INFO,arguments)},warn:function(){this.log(c.WARN,arguments)},error:function(){this.log(c.ERROR,arguments)},fatal:function(){this.log(c.FATAL,arguments)}},o(window.console&&window.console.log&&"function"==typeof window.console.log.apply?new t:new e),s=new a;for(var l,r=/loglevel(|-[^=]+)=([^&]+)/g;null!==(l=r.exec(window.location.search));){(""===l[1]?s:s.getLogger(l[1].slice(1))).setLevel(l[2].toUpperCase())}var d={Level:c,getLogger:s.getLogger.bind(s),setEnabled:s.setEnabled.bind(s),isEnabled:s.isEnabled.bind(s),setLevel:s.setLevel.bind(s),getLevel:s.getLevel.bind(s),debug:s.debug.bind(s),info:s.info.bind(s),warn:s.warn.bind(s),error:s.error.bind(s),fatal:s.fatal.bind(s),getWriter:i,setWriter:o};"function"==typeof define?define("logging",[],function(){return d}):window.logging=d}(),define("pat-logger",["logging"],function(e){return e.getLogger("patterns")}),define("mosaic-url/mosaic.tile",["jquery","pat-logger","underscore","mockup-utils","pat-registry","mockup-patterns-tinymce","tinymce","mockup-patterns-modal"],function(e,t,a,i,o,s,n,c){"use strict";var l=[],r=t.getLogger("pat-mosaic"),d=0,m=function(){clearTimeout(d),d=setTimeout(u,50)},u=function(){var t=e(".mosaic-selected-tile .mosaic-rich-text-toolbar").filter(":visible");if(0!==t.size()&&0!==t.find(".mce-first").size()){var a=t.parent();t.removeClass("right"),a.offset().left>=e(window).width()/2&&t.addClass("right");var i=e(window),o=e(".mosaic-toolbar").height();if(a.offset().top-t.height()<i.scrollTop()+o){if(!t.hasClass("sticky")){e("body").addClass("mce-sticky"),t.addClass("sticky");var s={top:e(".mosaic-toolbar").height()+t.height()};t.hasClass("right")?s.right=t.offset().right:s.left=t.offset().left,t.css(s)}}else t.removeClass("sticky"),t.removeAttr("style"),e("body").removeClass("mce-sticky")}};e(window).off("scroll",m).on("scroll",m);var p=function(t){var a=this;a.tinymce=null,a.$el=e(t),a.$el.is(".mosaic-tile")||(a.$el=a.$el.parents(".mosaic-tile")),a.focusCheckCount=0,a.$el.children(".mosaic-tile-content").off("blur").on("blur",function(){var t=a.getConfig();if(t&&"textapp"===t.tile_type){var o=a.getEditUrl();if(o){var s=a.getHtmlContent();if(s===a.$el.data("lastSavedData"))return;if(a.$el.data("activeSave"))return;a.$el.data("activeSave",!0);var n={_authenticator:i.getAuthenticator(),"buttons.save":"Save"};n[t.name+".content"]=s,e.mosaic.queue(function(t){e.ajax({url:o,method:"POST",data:n}).always(function(){a.$el.data("lastSavedData",s),a.$el.data("activeSave",!1),t()})})}}})};return p.prototype.getDataTileEl=function(e,t){return this.$el.find("[data-tile]")},p.prototype.getContentEl=function(e,t){return this.$el.children(".mosaic-tile-content")},p.prototype.getHtmlContent=function(){return this.getContentEl().html()},p.prototype.getEditUrl=function(){var t=this.getUrl();if(t&&(t=t.replace(/@@/,"@@edit-tile/")))return t.match(/^\.\/.*/)&&(t=e.mosaic.options.context_url+t.replace(/^\./,"")),t},p.prototype.getDeleteUrl=function(){var t=this.getUrl(),a=t.split("?")[0];a=a.split("@@");var i=a[1].split("/");return a=a[0]+"@@delete-tile/"+i[0]+"/"+i[1],a.match(/^\.\/.*/)&&(a=e.mosaic.options.context_url+a.replace(/^\./,"")),a},p.prototype.getUrl=function(){var t=this.$el.find(".tileUrl").html();if(!t){var a=this.$el.find("[data-tileUrl]");a.size()>0&&(t=a.attr("data-tileUrl"))}if(t||(t=this.$el.find("[data-tile]").attr("data-tile")),t)for(t=t.replace(e.mosaic.options.context_url,"./"),t=t.replace(/^\.\/\//,"./"),e.mosaic.hasContentLayout?-1===t.indexOf("X-Tile-Persistent")&&(-1===t.indexOf("?")?t+="?":t+="&",t+="X-Tile-Persistent=yes"):-1!==t.indexOf("X-Tile-Persistent")&&(t=t.replace("X-Tile-Persistent=yes","").replace("&&","&"));-1!==t.indexOf("&_layouteditor=true");)t=t.replace("&_layouteditor=true","");return t},p.prototype.getType=function(){var t="",a=this.$el,i=a.attr("class"),o=[];return i&&(o=a.attr("class").split(" "),e(o).each(function(){var e;null!==(e=this.match(/^mosaic-([\w.\-]+)-tile$/))&&"selected"!==e[1]&&"new"!==e[1]&&"read-only"!==e[1]&&"helper"!==e[1]&&"original"!==e[1]&&"edited"!==e[1]&&(t=e[1])})),t||r.error("Could not find tile type on element with classes: "+o.join(", ")),t},p.prototype.deprecatedHTMLTiles=["table","numbers","bullets","text","subheading","heading"],p.prototype.getConfig=function(){for(var t,a=this.getType(),i=0;i<e.mosaic.options.tiles.length;i+=1){for(var o=!1,s=e.mosaic.options.tiles[i],n=0;n<s.tiles.length;n+=1){if("field"===s.tiles[n].tile_type){var c=s.tiles[n].widget.split(".");switch(c=c[c.length-1]){case"TextWidget":case"TextFieldWidget":case"TextAreaWidget":case"TextAreaFieldWidget":case"TextLinesWidget":case"TextLinesFieldWidget":case"WysiwygWidget":case"WysiwygFieldWidget":case"RichTextWidget":case"RichTextFieldWidget":s.tiles[n].settings=!1;break;default:s.tiles[n].settings=!0}}if(s.tiles[n].name===a){t=s.tiles[n],o=!0;break}}if(o)break}return t||(-1===l.indexOf(a)&&(r.error("Could not load tile config for tile type: "+a+" falling back to b/w compatible tile type."),l.push(a)),t={tile_type:"app",name:a,label:"Unknown",read_only:!0,favorite:!1,settings:!1,weight:0,rich_text:!1},-1!==this.deprecatedHTMLTiles.indexOf(a)&&(t.category="structure",t.read_only=!1,t.label=a,t.tile_type="text",t.rich_text=!0)),t},p.prototype.getHtmlBody=function(t){var a="",i="",o=this.$el.attr("class").split(" ");i=this.getType(),o=e(o).filter(function(){switch(this){case"mosaic-new-tile":case"mosaic-helper-tile":case"mosaic-original-tile":case"mosaic-selected-tile":case"mosaic-edited-tile":return!1;default:return!0}}).toArray();var s,c=this.getConfig();switch(c.tile_type){case"text":s=n.get(this.$el.children(".mosaic-tile-content").attr("id")),a+='          <div class="'+o.join(" ")+'">\n',a+='          <div class="mosaic-tile-content">\n',a+=(s?s.getContent():this.$el.children(".mosaic-tile-content").html()).replace(/^\s+|\s+$/g,"")+"\n",a+="          </div>\n",a+="          </div>\n";break;case"app":case"textapp":var l=this.getUrl();if(t){s=n.get(this.$el.children(".mosaic-tile-content").attr("id"));var r=(s?s.getContent():this.$el.children(".mosaic-tile-content").html()).replace(/^\s+|\s+$/g,"")+"\n";-1===l.indexOf("?")?l+="?":l+="&",l+="content="+encodeURI(r)}a+='          <div class="'+o.join(" ")+'">\n',a+='          <div class="mosaic-tile-content">\n',a+='          <div data-tile="'+l+'"></div>\n',a+="          </div>\n",a+="          </div>\n";break;case"field":a+='          <div class="'+o.join(" ")+'">\n',a+='          <div class="mosaic-tile-content">\n';var d="./@@plone.app.standardtiles.field?field="+i,m=this.getValueFromClasses(o,"mosaic-subfield-");m&&(d+="&subfield="+m);var u=this.getValueFromClasses(o,"mosaic-format-");u&&(d+="&format="+u),a+='          <div data-tile="'+d+'"></div>\n',a+="          </div>\n",a+="          </div>\n",this.saveForm()}return a},p.prototype.isRichText=function(e){return void 0===e&&(e=this.getConfig()),!(!e||!1!==this.$el.hasClass("mosaic-read-only-tile")||!("text"===e.tile_type&&e.rich_text||"textapp"===e.tile_type&&e.rich_text||"app"===e.tile_type&&e.rich_text||"field"===e.tile_type&&!1===e.read_only&&("z3c.form.browser.text.TextWidget"===e.widget||"z3c.form.browser.text.TextFieldWidget"===e.widget||"z3c.form.browser.textarea.TextAreaWidget"===e.widget||"z3c.form.browser.textarea.TextAreaFieldWidget"===e.widget||"z3c.form.browser.textlines.TextLinesWidget"===e.widget||"z3c.form.browser.textlines.TextLinesFieldWidget"===e.widget||"plone.app.z3cform.widget.RichTextFieldWidget"===e.widget||"plone.app.z3cform.wysiwyg.widget.WysiwygWidget"===e.widget||"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget"===e.widget||"plone.app.widgets.dx.RichTextWidget"===e.widget)))},p.prototype.initialize=function(){var t=this.getConfig();t&&t.read_only&&this.$el.addClass("mosaic-read-only-tile"),this.isRichText()&&this.setupWysiwyg(),this.$el.prepend(e(e.mosaic.document.createElement("div")).addClass("mosaic-tile-outer-border").append(e(e.mosaic.document.createElement("div")).addClass("mosaic-tile-inner-border"))),t&&this.$el.prepend(e(e.mosaic.document.createElement("div")).addClass("mosaic-tile-control mosaic-tile-label").append(e(e.mosaic.document.createElement("div")).addClass("mosaic-tile-label-content").html(t.label)).append(e(e.mosaic.document.createElement("div")).addClass("mosaic-tile-label-left"))),this.makeMovable(),this.initializeButtons();var i=this;a.each(["top","bottom","right","left"],function(t){i.$el.prepend(e(e.mosaic.document.createElement("div")).addClass("mosaic-divider mosaic-divider-"+t).append(e(e.mosaic.document.createElement("div")).addClass("mosaic-divider-dot")))})},p.prototype.initializeButtons=function(){var t=[],a=this.getConfig();this.$el.find(".mosaic-tile-buttons").remove();var i=function(a,i,o){var s=document.createElement("button");return s.className="mosaic-btn-"+i,s.textContent=a,t.push(s),e(s).on("click",o),s};if(a&&a.settings&&!1===this.$el.hasClass("mosaic-read-only-tile")&&i("Edit","settings",this.settingsClicked.bind(this)),!e.mosaic.hasContentLayout){i("Delete","delete",this.deleteClicked.bind(this));var o=i("Confirm delete","confirm",this.confirmClicked.bind(this));e(o).hide();var s=i("Cancel","cancel",this.cancelClicked.bind(this));e(s).hide()}if(t.length>0){var n=e(e.mosaic.document.createElement("div")).addClass("mosaic-tile-control mosaic-tile-buttons");this.$el.prepend(n),t.forEach(function(e){n.append(e)})}},p.prototype.cancelClicked=function(t){t.preventDefault(),e(".mosaic-btn-settings,.mosaic-btn-delete",this.$el).show(),e(".mosaic-btn-cancel,.mosaic-btn-confirm",this.$el).hide()},p.prototype.deleteClicked=function(t){t.preventDefault(),e(".mosaic-btn-settings,.mosaic-btn-delete",this.$el).hide(),e(".mosaic-btn-cancel,.mosaic-btn-confirm",this.$el).show()},p.prototype.confirmClicked=function(t){t.preventDefault();var a=this,o=this.getConfig();if("app"===o.tile_type||"textapp"===o.tile_type){var s=this.getUrl();s&&"undefined"!==s&&(e.mosaic.removeHeadTags(s),e.mosaic.queue(function(t){e.ajax({type:"POST",url:a.getDeleteUrl(),data:{"buttons.delete":"Delete",_authenticator:i.getAuthenticator()}}).always(function(){t()})}))}e.mosaic.options.panels.find(".mosaic-empty-row").remove();var n=this.$el.parent().parent();this.saveForm(),this.$el.remove(),n.mosaicCleanupRow(),e.mosaic.options.panels.mosaicAddEmptyRows(),e.mosaic.options.toolbar.trigger("selectedtilechange"),e.mosaic.options.toolbar.mosaicSetResizeHandleLocation()},p.prototype.settingsClicked=function(t){t.preventDefault();var a=this,i=a.getConfig();if("app"===i.tile_type){var o=a.getEditUrl();e.mosaic.overlay.app=new c(e(".mosaic-toolbar"),{ajaxUrl:o,loadLinksWithinModal:!0,buttons:'.formControls > input[type="submit"], .actionButtons > input[type="submit"]'}),e.mosaic.overlay.app.$el.off("after-render"),e.mosaic.overlay.app.on("after-render",function(t){e('input[name*="cancel"]',e.mosaic.overlay.app.$modal).off("click").on("click",function(){e.mosaic.overlay.app.hide(),e.mosaic.overlay.app=null}),e.mosaic.hasContentLayout&&e("form",e.mosaic.overlay.app.$modal).append(e('<input type="hidden" name="X-Tile-Persistent" value="yes" />'))}),e.mosaic.overlay.app.show(),e.mosaic.overlay.app.$el.off("formActionSuccess"),e.mosaic.overlay.app.on("formActionSuccess",function(t,i,o,s,n){var c=s.getResponseHeader("X-Tile-Url"),l=e.mosaic.getDomTreeFromHtml(i);if(c){e.mosaic.removeHeadTags(c),e.mosaic.addHeadTags(c,l);var r=l.find(".temp_body_tag").html();a.fillContent(r,c),e.mosaic.overlay.app.hide(),e.mosaic.overlay.app=null}})}else e.mosaic.overlay.open("field",i)},p.prototype.makeMovable=function(){this.$el.hasClass("movable")&&e.mosaic.options.canChangeLayout&&!e.mosaic.hasContentLayout&&this.$el.prepend(e(e.mosaic.document.createElement("div")).addClass("mosaic-tile-control mosaic-drag-handle"))},p.prototype.getValueFromClasses=function(e,t){var a;return e.forEach(function(e){-1!==e.indexOf(t)&&(a=e.replace(t,""))}),a},p.prototype.initializeContent=function(){var t,a,i,o,s,n=this,c=e("body",e.mosaic.document).attr("data-base-url");c||(c=e("head > base",e.mosaic.document).attr("href"));var l=this.getUrl(),d=this.getConfig();if("field"===d.tile_type){switch(o="","IDublinCore-title"===d.name?(a='<h1 class="documentFirstHeading">',i="</h1>"):"IDublinCore-description"===d.name?(a='<p class="documentDescription">',i="</p>"):(a="<div>",i="</div>"),d.widget){case"z3c.form.browser.text.TextWidget":case"z3c.form.browser.text.TextFieldWidget":o=a+e("#"+d.id).find("input").attr("value")+i;break;case"z3c.form.browser.textarea.TextAreaWidget":case"z3c.form.browser.textarea.TextAreaFieldWidget":case"z3c.form.browser.textlines.TextLinesWidget":case"z3c.form.browser.textlines.TextLinesFieldWidget":s=e("#"+d.id).find("textarea").val().split("\n"),o+=a;for(var m=0;m<s.length;m+=1)o+=s[m]+"<br/>";o+=i;break;case"plone.app.z3cform.widget.RichTextFieldWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget":case"plone.app.widgets.dx.RichTextWidget":o=e("#"+d.id).find("textarea").val();break;default:o='<div class="discreet">Placeholder for field:<br/><b>'+d.label+"</b></div>"}n.fillContent(o)}else if(d){n.$el.addClass("mosaic-tile-loading"),t=c?[c,l].join("/").replace(/\/+\.\//g,"/"):l;var u=t;-1===t.indexOf("?")?t+="?":t+="&",-1===t.indexOf("_layouteditor")&&(t+="_layouteditor=true"),e.ajax({type:"POST",url:t,success:function(t){n.$el.removeClass("mosaic-tile-loading"),t=e.mosaic.getDomTreeFromHtml(t),e.mosaic.addHeadTags(l,t);var a=t.find(".temp_body_tag").html();n.fillContent(a,u),"plone.app.standardtiles.html"===n.getType()&&(n.$el.data("lastSavedData")||n.$el.data("lastSavedData",n.getHtmlContent()))},error:function(){n.$el.removeClass("mosaic-tile-loading"),r.error("Error getting data for the tile "+d.label+"("+d.name+"). Please read documentation on how to correctly register tiles: https://pypi.python.org/pypi/plone.tiles")}})}},p.prototype.fillContent=function(e,t){var a,i=this.getDataTileEl();if(i.length>0?(i.parent().html(e),a=this.getContentEl()):(a=this.getContentEl(),a.html(e)),t&&a.size()>0){for(t=t.replace(/&/gim,"&amp;");-1!==t.indexOf("&amp;&amp;");)t=t.replace("&amp;&amp;","&amp;");a.attr("data-tileUrl",t)}this.cacheHtml(e),this.scanRegistry()},p.prototype.cacheHtml=function(e){if(!this.isRichText()){var t=this.$el.children(".mosaic-tile-content");0!==t.size()&&(void 0===e&&(e=t.html()),t[0]._preScanHTML=e)}},p.prototype.scanRegistry=function(){if(!this.isRichText()){var t=this.$el.find(".mosaic-tile-content");0!==t.size()&&(t[0]._preScanHTML&&t.html(t[0]._preScanHTML),o.scan(t),e("a",t).on("click",function(e){e.preventDefault(),e.stopPropagation()}))}},p.prototype.select=function(){if(!1===this.$el.hasClass("mosaic-selected-tile")&&!1===this.$el.hasClass("mosaic-read-only-tile")){var t=e(".mosaic-selected-tile",e.mosaic.document);if(1===t.size()){new p(t).blur()}this.focus()}},p.prototype._change=function(){e.mosaic.options.toolbar.trigger("selectedtilechange"),e.mosaic.options.panels.mosaicSetResizeHandleLocation(),this.saveForm()},p.prototype.blur=function(){this.$el.removeClass("mosaic-selected-tile").children(".mosaic-tile-content").blur(),this.$el.find(".mce-edit-focus").removeClass("mce-edit-focus"),this._change()},p.prototype._focus=function(){var e=this;this.$el.addClass("mosaic-selected-tile"),this.$el.children(".mosaic-tile-content").focus(),this._change(),this.initializeButtons();e.isRichText()&&e.focusCheckCount<30&&function(){e.focusCheckTimeout&&clearTimeout(e.focusCheckTimeout),e.focusCheckTimeout=setTimeout(function(){if(e.focusCheckCount+=1,e.$el.hasClass("mosaic-selected-tile")){e.$el.find(".mosaic-rich-text").hasClass("mce-edit-focus")||(e.$el.removeClass("mosaic-selected-tile").children(".mosaic-tile-content").blur(),e.$el.find(".mce-edit-focus").removeClass("mce-edit-focus"),e._focus())}},50)}()},p.prototype.focus=function(){this.isRichText()&&!0!==this.$el.data("tinymce-loaded")?this.$el.data("delayed-focus",!0):this._focus()},p.prototype.saveForm=function(){var t,a,i,o=this.getType(),s=this.getConfig();if(s&&"field"===s.tile_type&&!1===s.read_only&&("z3c.form.browser.text.TextWidget"===s.widget||"z3c.form.browser.text.TextFieldWidget"===s.widget||"z3c.form.browser.textarea.TextAreaWidget"===s.widget||"z3c.form.browser.textarea.TextAreaFieldWidget"===s.widget||"z3c.form.browser.textlines.TextLinesWidget"===s.widget||"z3c.form.browser.textlines.TextLinesFieldWidget"===s.widget||"plone.app.z3cform.widget.RichTextFieldWidget"===s.widget||"plone.app.z3cform.wysiwyg.widget.WysiwygWidget"===s.widget||"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget"===s.widget||"plone.app.widgets.dx.RichTextWidget"===s.widget))switch(s.widget){case"z3c.form.browser.text.TextWidget":case"z3c.form.browser.text.TextFieldWidget":var c=e(".mosaic-panel .mosaic-"+o+"-tile",e.mosaic.document);c.size()>1&&(c=c.filter(function(){return e(".mosaic-tile-control",this).length>0}));var l=c.find(".mosaic-tile-content > *").text();e("#"+s.id).find("input").val(l);break;case"z3c.form.browser.textarea.TextAreaWidget":case"z3c.form.browser.textarea.TextAreaFieldWidget":case"z3c.form.browser.textlines.TextLinesWidget":case"z3c.form.browser.textlines.TextLinesFieldWidget":i="",e(".mosaic-panel .mosaic-"+o+"-tile",e.mosaic.document).find(".mosaic-tile-content > *").each(function(){i+=e(this).text()}),i=i.replace(/^\s+|\s+$/g,""),e("#"+s.id).find("textarea").val(i);break;case"plone.app.z3cform.widget.RichTextFieldWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget":case"plone.app.widgets.dx.RichTextWidget":var r=e(document.getElementById(s.id)).find("textarea");t=r.attr("id"),a=n.get(t);var d=e(".mosaic-"+o+"-tile",e.mosaic.document).find(".mosaic-tile-content").html();r.val(d),a&&a.setContent(d)}},p.prototype.setupWysiwyg=function(){var t=this,a=t.$el.find(".mosaic-tile-content");try{a.data("pattern-tinymce").destroy(),a.removeData("pattern-tinymce"),t.$el.data("tinymce-loaded",!1)}catch(e){}for(var i=1+Math.floor(1e5*Math.random());e("#mosaic-rich-text-init-"+i,e.mosaic.document).length>0;)i=1+Math.floor(1e5*Math.random());var o="mosaic-rich-text-init-"+i;a.attr("id",o),a.siblings(".mosaic-rich-text-toolbar").remove();var n=e('<div class="mosaic-rich-text-toolbar" />').attr("id",o+"-toolbar");a.before(n);var c,l,r,d,u,h,f=t.getType();for(-1!==this.deprecatedHTMLTiles.indexOf(f)&&(f="plone.app.standardtiles.html"),c=e.mosaic.options.default_available_actions,r=0;r<e.mosaic.options.tiles.length;r+=1)for(l=e.mosaic.options.tiles[r],d=0;d<l.tiles.length;d+=1)l.tiles[d].name===f&&(c=c.concat(l.tiles[d].available_actions));for(u=[],r=0;r<e.mosaic.options.richtext_toolbar.length;r+=1){for(l=e.mosaic.options.richtext_toolbar[r],d=0;d<l.actions.length;d+=1)e.inArray(l.actions[d].name,c)>-1&&u.push(l.actions[d].action);u.length&&"|"!=u[u.length-1]&&u.push("|")}for(u.length&&"|"==u[u.length-1]&&u.pop(),h=[],r=0;r<e.mosaic.options.richtext_contextmenu.length;r+=1){for(l=e.mosaic.options.richtext_contextmenu[r],d=0;d<l.actions.length;d+=1)e.inArray(l.actions[d].name,c)>-1&&h.push(l.actions[d].action);h.length&&"|"!=h[h.length-1]&&h.push("|")}h.length&&"|"==h[h.length-1]&&h.pop();var g=function(){var e=a.find("p > *");(0===e.length||1===e.length&&e.is("br"))&&0===a.text().replace(/^\s+|\s+$/g,"").length?(a.addClass("mosaic-tile-content-empty"),0===a.find("p").length&&a.empty().append("<p></p>")):a.removeClass("mosaic-tile-content-empty")},v=0,y=function(){clearTimeout(v),v=setTimeout(g,100)},w=e.mosaic.options.tinymce.tiny.paste_as_text||!1;0===u.length&&(w=!0),new s(a,e.extend(!0,{},e.mosaic.options.tinymce,{inline:!1,tiny:{body_id:o,selector:"#"+o,inline:!0,paste_as_text:w,fixed_toolbar_container:"#"+n.attr("id"),ui_container:"#"+n.attr("id"),theme_advanced_toolbar_align:"right",menubar:!1,toolbar:u.join(" ")||!1,statusbar:!1,contextmenu:h.join(" ")||!1,plugins:e.mosaic.options.tinymce.tiny.plugins.concat(h.length?["contextmenu"]:[]),setup:function(a){t.tinymce=a,a.on("focus",function(a){a.target.id&&(0===e(".mosaic-helper-tile").length?(t.select(),m()):setTimeout(function(){e(".mce-edit-focus").each(function(){new p(e(this).parent()).blur();var t=window.tinyMCE.get(this.getAttribute("id"));t&&t.hide()})},10))}),0===u.length&&a.on("keydown",function(e){if(13===e.keyCode)return void e.preventDefault()}),a.on("keyup change",y),y(),a.on("init",function(){t.$el.data("tinymce-loaded",!0),!0===t.$el.data("delayed-focus")&&(t.$el.data("delayed-focus",!1),setTimeout(function(){t._focus()},100))})}}})),a.addClass("mosaic-rich-text")},p.validTile=function(t){var a=e(t);return!!a.is(".mosaic-tile")||a.parents(".mosaic-tile").size()>0},p}),define("mosaic-url/mosaic.panel",["jquery","pat-logger","underscore"],function(e,t,a){"use strict";var i=t.getLogger("pat-mosaic"),o=function(t){this.$el=e(t)};return o.prototype.initialize=function(t){var a,i=this.$el.data("panel"),o=e("[data-panel="+i+"]",e.mosaic.document),s=this.$el.data("max-columns")||4;"content"===i&&0===o.length&&e("#"+i,e.mosaic.document).each(function(){o=e(this),o.attr("data-panel",i)}),"content"===i?(a=o.attr("id"),0===e(".mosaic-original-content",e.mosaic.document).size()?(o.before(e(document.createElement("div")).attr("id",a).attr("class",o.attr("class")).addClass("mosaic-panel").attr("data-panel","content").attr("data-max-columns",s).html(t.find("[data-panel="+i+"]").html())),o.removeAttr("data-panel").removeAttr("id").addClass("mosaic-original-content")):o.replaceWith(e(document.createElement("div")).attr("id",a).attr("class",o.attr("class")).addClass("mosaic-panel").attr("data-panel","content").attr("data-max-columns",s).html(t.find("[data-panel="+i+"]").html()))):(o.attr("class",t.find("[data-panel="+i+"]").attr("class")),o.addClass("mosaic-panel"),o.html(t.find("[data-panel="+i+"]").html()))},o.prototype.prefill=function(){this.$el.hasClass("mosaic-panel")||(i.info(e(this)),e(this).addClass("mosaic-panel"),e(this).children().wrap(e('<div class="mosaic-grid-row"><div class="mosaic-grid-cell mosaic-width-full mosaic-position-leftmost"><div class="movable removable mosaic-tile mosaic-text-tile"><div class="mosaic-tile-content"></div></div></div></div>')))},o}),define("mosaic-url/mosaic.layout",["jquery","mosaic-url/mosaic.tile","pat-logger","underscore","pat-registry","mockup-patterns-modal"],function(e,t,a,i,o,s){"use strict";function n(e){switch(e){case 25:return"mosaic-width-quarter";case 33:return"mosaic-width-third";case 50:return"mosaic-width-half";case 66:case 67:return"mosaic-width-two-thirds";case 75:return"mosaic-width-three-quarters";case 100:return"mosaic-width-full"}return"mosaic-width-full"}function c(e){switch(e){case 0:return"mosaic-position-leftmost";case 25:return"mosaic-position-quarter";case 33:return"mosaic-position-third";case 50:return"mosaic-position-half";case 66:case 67:return"mosaic-position-two-thirds";case 75:return"mosaic-position-three-quarters"}return"mosaic-position-leftmost"}return void 0===e.mosaic&&(e.mosaic={}),e.mosaic.layout={widthClasses:["mosaic-width-quarter","mosaic-width-third","mosaic-width-half","mosaic-width-two-thirds","mosaic-width-three-quarters","mosaic-width-full"],positionClasses:["mosaic-position-leftmost","mosaic-position-quarter","mosaic-position-third","mosaic-position-half","mosaic-position-two-thirds","mosaic-position-three-quarters"]},e.fn.mosaicLayout=function(){var a=function(t){if(18===t.keyCode){var a=new Date,i=e(".mosaic-panel",e.mosaic.document).data("advanced-enabled");a.getTime()-i>400&&e(".mosaic-panel",e.mosaic.document).removeClass("mosaic-advanced")}17===t.keyCode&&e(".mosaic-panel",e.mosaic.document).removeClass("inner-subcolumn")},o=function(a){if(18===a.keyCode)if(e(".mosaic-panel",e.mosaic.document).hasClass("mosaic-advanced"))e(".mosaic-panel",e.mosaic.document).removeClass("mosaic-advanced");else{var i=new Date;e(".mosaic-panel",e.mosaic.document).addClass("mosaic-advanced"),e(".mosaic-panel",e.mosaic.document).data("advanced-enabled",i.getTime())}if(17===a.keyCode&&e(".mosaic-panel",e.mosaic.document).addClass("inner-subcolumn"),27===a.keyCode){var o=e(".mosaic-original-tile",e.mosaic.document);o.length>0?o.each(function(){e(this).addClass("mosaic-drag-cancel"),e(this).hasClass("mosaic-helper-tile-new")?e(document).trigger("mousedown"):e(document).trigger("mouseup")}):e(".mosaic-selected-tile",e.mosaic.document).each(function(){new t(this).blur()}),e(".mosaic-resize-handle-helper",e.mosaic.document).each(function(){e(this).parents("[data-panel]").removeClass("mosaic-panel-resizing"),e(this).parent().removeClass("mosaic-row-resizing"),e(this).parent().children(".mosaic-resize-placeholder").remove(),e(this).remove()}),e.mosaic.overlay.app&&e.mosaic.overlay.app.hide()}};e(e.mosaic.document).off("keydown").on("keydown",o),e(e.mosaic.document).off("keyup").on("keyup",a);var s=function(t){var a;if(t.target?a=t.target:t.srcElement&&(a=t.srcElement),!(e(a).parents(".mce-panel").length>0)){0===e(a).parents(".mosaic-tile").length&&0===e(a).parents(".mosaic-toolbar").length&&(e(".mosaic-selected-tile",e.mosaic.document).removeClass("mosaic-selected-tile").children(".mosaic-tile-content").blur(),e.mosaic.options.toolbar.trigger("selectedtilechange"),e.mosaic.options.panels.mosaicSetResizeHandleLocation());var i=e(".mosaic-helper-tile-new",e.mosaic.document);i.length>0&&i.each(function(){e(this).mosaicHandleDragEnd()})}};e(e.mosaic.document).off("mousedown").on("mousedown",s);var l=function(t){e(".mosaic-helper-tile-new",e.mosaic.document).each(function(){var a=e(this).parent().offset();e(this).css("top",t.pageY+3-a.top),e(this).css("left",t.pageX+3-a.left)}),e(".mosaic-resize-handle-helper",e.mosaic.document).each(function(){var a,i,o=e(this),s=o.parent(),l=parseFloat(t.pageX-s.offset().left-4),r=l/o.data("row_width")*100,d=25,m=1e3;if(e([25,33,50,67,75]).each(function(){(i=Math.abs(this-r))<m&&(d=this,m=i)}),2===o.data("nr_of_columns"))o.data("column_sizes").split(" ")[0]!==d&&(s.children(".mosaic-resize-placeholder").each(function(t){0===t?e(this).removeClass(e.mosaic.layout.widthClasses.join(" ")).addClass(n(parseInt(d,10))):(e(this).removeClass(e.mosaic.layout.positionClasses.join(" ").replace(/position/g,"resize")).removeClass(e.mosaic.layout.widthClasses.join(" ")).addClass(n(parseInt(100-d,10))).addClass(c(parseInt(d,10)).replace("position","resize")),o.removeClass(e.mosaic.layout.positionClasses.join(" ").replace(/position/g,"resize")).addClass(c(parseInt(d,10)).replace("position","resize")))}),e(this).data("column_sizes",d+" "+(100-d)));else{if(1===e(this).data("resize_handle_index")){if(o.data("column_sizes").split(" ")[e(this).data("resize_handle_index")-1]!==d&&parseInt(d,10)<=50)switch(a=s.children(".mosaic-resize-placeholder"),a.removeClass(e.mosaic.layout.positionClasses.join(" ").replace(/position/g,"resize")).removeClass(e.mosaic.layout.widthClasses.join(" ")),o.removeClass(e.mosaic.layout.positionClasses.join(" ").replace(/position/g,"resize")).addClass(c(parseInt(d,10)).replace("position","resize")),parseInt(d,10)){case 25:e(a.get(0)).addClass(c(0).replace("position","resize")+" "+n(25)),e(a.get(1)).addClass(c(25).replace("position","resize")+" "+n(50)),e(a.get(2)).addClass(c(75).replace("position","resize")+" "+n(25)),o.data("column_sizes","25 50 25");break;case 33:e(a.get(0)).addClass(c(0).replace("position","resize")+" "+n(33)),e(a.get(1)).addClass(c(33).replace("position","resize")+" "+n(33)),e(a.get(2)).addClass(c(66).replace("position","resize")+" "+n(33)),o.data("column_sizes","33 33 33");break;case 50:e(a.get(0)).addClass(c(0).replace("position","resize")+" "+n(50)),e(a.get(1)).addClass(c(50).replace("position","resize")+" "+n(25)),e(a.get(2)).addClass(c(75).replace("position","resize")+" "+n(25)),o.data("column_sizes","50 25 25")}}else if(o.data("column_sizes").split(" ")[e(this).data("resize_handle_index")]!==100-d&&parseInt(d,10)>=50)switch(a=s.children(".mosaic-resize-placeholder"),a.removeClass(e.mosaic.layout.positionClasses.join(" ").replace(/position/g,"resize")).removeClass(e.mosaic.layout.widthClasses.join(" ")),o.removeClass(e.mosaic.layout.positionClasses.join(" ").replace(/position/g,"resize")).addClass(c(parseInt(d,10)).replace("position","resize")),parseInt(d,10)){case 50:e(a.get(0)).addClass(c(0).replace("position","resize")+" "+n(25)),e(a.get(1)).addClass(c(25).replace("position","resize")+" "+n(25)),e(a.get(2)).addClass(c(50).replace("position","resize")+" "+n(50)),o.data("column_sizes","25 25 50");break;case 66:case 67:e(a.get(0)).addClass(c(0).replace("position","resize")+" "+n(33)),e(a.get(1)).addClass(c(33).replace("position","resize")+" "+n(33)),e(a.get(2)).addClass(c(66).replace("position","resize")+" "+n(33)),o.data("column_sizes","33 33 33");break;case 75:e(a.get(0)).addClass(c(0).replace("position","resize")+" "+n(25)),e(a.get(1)).addClass(c(25).replace("position","resize")+" "+n(50)),e(a.get(2)).addClass(c(75).replace("position","resize")+" "+n(25)),o.data("column_sizes","25 50 25")}}})};e(e.mosaic.document).off("mousemove").on("mousemove",l),e(e.mosaic.document).off("dragover").on("dragover",l);var r=function(a){e(".mosaic-resize-handle-helper",e.mosaic.document).each(function(){var a=e(this).parents("[data-panel]"),i=e(this).data("column_sizes").split(" ");e(this).parent().children(".mosaic-grid-cell").each(function(t){for(var a=0,o=0;o<t;o+=1)a+=parseInt(i[o],10);e(this).removeClass(e.mosaic.layout.positionClasses.join(" ")).removeClass(e.mosaic.layout.widthClasses.join(" ")).addClass(c(a)+" "+n(parseInt(i[t],10)))}),a.removeClass("mosaic-panel-resizing"),e(this).parent().removeClass("mosaic-row-resizing"),e(this).parent().children(".mosaic-resize-placeholder").remove(),e(this).parent().mosaicSetResizeHandles(),a.mosaicSetResizeHandleLocation();var o=a.find(".mosaic-selected-tile");if(o.size()>0){new t(o).select()}e(this).remove()})};e(e.mosaic.document).off("mouseup").on("mouseup",r);var d=function(t){
if(e(this).parents("[data-panel]").hasClass("mosaic-panel-dragging")&&(e(".mosaic-selected-divider",e.mosaic.document).removeClass("mosaic-selected-divider"),!1===e(this).hasClass("mosaic-original-tile")&&!1===e(this).hasClass("mosaic-tile-align-left")&&!1===e(this).hasClass("mosaic-tile-align-right"))){var a=e(this).mosaicGetDirection(t),i=e(this).children(".mosaic-divider-"+a);if("left"===a||"right"===a){var o=i.parent().parent().parent();if(o.children(".mosaic-grid-cell").length>=e(".mosaic-panel").data("max-columns"))return;o.children(".mosaic-grid-cell").length>1?(i.height(o.height()+5),i.css("top",o.offset().top-i.parent().offset().top-5)):(i.height(i.parent().height()+5),i.css("top",-5))}i.addClass("mosaic-selected-divider")}};e(e.mosaic.document).off("mousemove",".mosaic-tile").on("mousemove",".mosaic-tile",d),e(e.mosaic.document).off("dragover",".mosaic-tile").on("dragover",".mosaic-tile",d),e(e.mosaic.document).off("click",".mosaic-tile").on("click",".mosaic-tile",function(){if(0===e(".mosaic-helper-tile-new",e.mosaic.document).length){new t(this).select()}});var m=function(t){"custom-css-input-box"!==e(t.target).attr("id")&&e.each(e("div.mosaic-set-custom-css"),function(){var t=e(this).parent(),a="mosaic-grid-row";t.hasClass("mosaic-innergrid-row")&&(a="mosaic-grid-row mosaic-innergrid-row"),a+=" "+e(this).find("input#custom-css-input-box").val(),t.attr("class",a),e(this).remove()})},u=function(t){var a=e(t.target);if(a.parents("[data-panel]").hasClass("mosaic-advanced")&&a.hasClass("mosaic-grid-row")){if(e(a).find(".mosaic-set-custom-css").length>0)return;var i=[];e.each(a.attr("class").split(" "),function(){void 0!==this&&"mosaic-grid-row"!==this&&"mosaic-innergrid-row"!==this&&i.push(this)});var o=e("<input type='text' id='custom-css-input-box'></input>").val(i.join(" ")),s=e("<div></div>").addClass("mosaic-set-custom-css").append(e("<label>Custom CSS for this row:</label>")).append(o);a.append(s)}};e(e.mosaic.document).on("dblclick",".mosaic-grid-row",u),e(e.mosaic.document).on("click",m);var p=this.length;return this.each(function(a){var o=e(this);if(o.find(".mosaic-tile").each(function(){var e=new t(this);e.initialize(),e.scanRegistry()}),o.find(".mosaic-tile").mosaicAddDrag(),o.mosaicAddEmptyRows(),o.children(".mosaic-grid-row").mosaicSetResizeHandles(),a===p-1){var s=0,n=0;e.mosaic.options.panels.each(function(t){e(this).width()>s&&(s=e(this).width(),n=t)});var c=e.mosaic.options.panels.eq(n).find(".mosaic-tile:first");if(c.size()>0){new t(c).select()}}o.find(".mosaic-innergrid-row").each(function(){e(this).mosaicAddMouseMoveInnergridRow(),e(this).mosaicSetResizeHandles();var t=e(this);i.each(["top","bottom"],function(a){t.append(e(e.mosaic.document.createElement("div")).addClass("mosaic-divider mosaic-divider-"+a).append(e(e.mosaic.document.createElement("div")).addClass("mosaic-divider-dot")))})})})},e.fn.mosaicAddMouseMoveEmptyRow=function(){return this.each(function(){e(this).mousemove(function(){e(this).parents("[data-panel]").hasClass("mosaic-panel-dragging")&&(e(".mosaic-selected-divider",e.mosaic.document).removeClass("mosaic-selected-divider"),e(this).children("div").addClass("mosaic-selected-divider"))})})},e.fn.mosaicAddMouseMoveInnergridRow=function(){return this.each(function(){e(this).mousemove(function(t){if(e(this).parents("[data-panel]").hasClass("mosaic-panel-dragging")){e(".mosaic-selected-divider",e.mosaic.document).removeClass("mosaic-selected-divider");var a=e(this).mosaicGetDirection(t);e(this).children(".mosaic-divider-"+a).addClass("mosaic-selected-divider")}})})},e.fn.mosaicAddEmptyRows=function(){return this.each(function(){e(this).find(".mosaic-grid-row:not(.mosaic-innergrid-row)").each(function(t){e(this).before(e(e.mosaic.document.createElement("div")).addClass("mosaic-grid-row mosaic-empty-row").append(e(e.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-full mosaic-position-leftmost").append(e(e.mosaic.document.createElement("div")).append(e(e.mosaic.document.createElement("div")).addClass("mosaic-tile-outer-border").append(e(e.mosaic.document.createElement("div")).addClass("mosaic-divider-dot"))))).mosaicAddMouseMoveEmptyRow()),0===e(this).nextAll(".mosaic-grid-row").length&&e(this).after(e(e.mosaic.document.createElement("div")).addClass("mosaic-grid-row mosaic-empty-row").append(e(e.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-full mosaic-position-leftmost").append(e(e.mosaic.document.createElement("div")).append(e(e.mosaic.document.createElement("div")).addClass("mosaic-tile-outer-border").append(e(e.mosaic.document.createElement("div")).addClass("mosaic-divider-dot"))))).mosaicAddMouseMoveEmptyRow())}),0===e(this).find(".mosaic-grid-row:not(.mosaic-innergrid-row)").length&&e(this).append(e(e.mosaic.document.createElement("div")).addClass("mosaic-grid-row mosaic-empty-row").append(e(e.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-full mosaic-position-leftmost").append(e(e.mosaic.document.createElement("div")).append(e(e.mosaic.document.createElement("div")).addClass("mosaic-tile-outer-border").append(e(e.mosaic.document.createElement("div")).addClass("mosaic-divider-dot"))))).mosaicAddMouseMoveEmptyRow())})},e.fn.mosaicGetWidthClass=function(){var t;for(t in e.mosaic.layout.widthClasses)if(e.mosaic.layout.widthClasses.hasOwnProperty(t)&&e(this).hasClass(e.mosaic.layout.widthClasses[t]))return e.mosaic.layout.widthClasses[t];for(t in e.mosaic.layout.widthClasses)if(e.mosaic.layout.widthClasses.hasOwnProperty(t)&&e(this).hasClass(e.mosaic.layout.widthClasses[t].replace("position","resize")))return e.mosaic.layout.widthClasses[t];return e.mosaic.layout.widthClasses[0]},e.fn.mosaicGetPositionClass=function(){var t;for(t in e.mosaic.layout.positionClasses)if(e(this).hasClass(e.mosaic.layout.positionClasses[t]))return e.mosaic.layout.positionClasses[t];for(t in e.mosaic.layout.positionClasses)if(e(this).hasClass(e.mosaic.layout.positionClasses[t].replace("position","resize")))return e.mosaic.layout.positionClasses[t];return e.mosaic.layout.positionClasses[0]},e.fn.mosaicAddDrag=function(){return this.each(function(){var t=e(this),a=function(t){var a=e(".mosaic-helper-tile",e.mosaic.document),i=a.parents("[data-panel]").offset();a.css("top",t.pageY+3-i.top),a.css("left",t.pageX+3-i.left)},i=function(){var t=e(".mosaic-helper-tile",e.mosaic.document);e(e.mosaic.document).unbind("mousemove",a).unbind("mouseup",i),t.mosaicHandleDragEnd(),t.remove()};return t.each(function(){t.find("div.mosaic-drag-handle").unbind("mousedown").bind("mousedown",function(t){var o=t.pageX,s=t.pageY,n=function(t){if(Math.max(Math.abs(o-t.pageX),Math.abs(s-t.pageY))>=1){e.mosaic.options.panels.addClass("mosaic-panel-dragging"),e(".mosaic-selected-tile",e.mosaic.document).removeClass("mosaic-selected-tile").children(".mosaic-tile-content").blur();var c=e(t.target).parents(".mosaic-tile"),l=c.clone(!0);c.addClass("mosaic-original-tile"),c.parents("[data-panel]").append(l),l.css({width:c.width(),position:"absolute",opacity:.5}).addClass("mosaic-helper-tile"),e(e.mosaic.document).mousemove(a),e(e.mosaic.document).mouseup(i),e(e.mosaic.document).unbind("mousemove",n)}};e(e.mosaic.document).bind("mousemove",n),e(e.mosaic.document).bind("mouseup",function(){e(e.mosaic.document).unbind("mousemove",n)})})})})},e.fn.mosaicHandleDragEnd=function(){var a=e(this).parents("[data-panel]");e.mosaic.options.panels.removeClass("mosaic-panel-dragging mosaic-panel-dragging-new");var o=e(".mosaic-selected-divider",e.mosaic.document),s=o.parent(),n="";i.each(["top","bottom","left","right"],function(e){o.hasClass("mosaic-divider-"+e)&&(n=e)}),o.removeClass("mosaic-selected-divider");var c=e(".mosaic-helper-tile-new",e.mosaic.document).length>0,l=e(".mosaic-original-tile",e.mosaic.document);if((0===o.length||s.hasClass("mosaic-helper-tile"))&&l.addClass("mosaic-drag-cancel"),l.hasClass("mosaic-drag-cancel"))l.removeClass("mosaic-drag-cancel"),c||l.removeClass("mosaic-original-tile").addClass("mosaic-new-tile");else if(s.hasClass("mosaic-empty-row"))s.removeClass("mosaic-empty-row").attr("class",l.parents(".mosaic-grid-row").first().attr("class")).unbind("mousemove"),s.children(".mosaic-grid-cell").children("div").remove(),s.children(".mosaic-grid-cell").append(l.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile"));else if(!1===s.hasClass("mosaic-tile")&&!1===s.hasClass("mosaic-innergrid-row"))c||l.removeClass("mosaic-original-tile").addClass("mosaic-new-tile");else if(s.parent().parent().children(".mosaic-grid-cell").length>=a.data("max-columns")&&("left"===n||"right"===n))c||l.removeClass("mosaic-original-tile").addClass("mosaic-new-tile");else{var r=l.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile");if(a.hasClass("inner-subcolumn")&&(r=e(e.mosaic.document.createElement("div")).addClass("mosaic-grid-row mosaic-innergrid-row").append(e(e.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-full mosaic-position-leftmost").append(e(e.mosaic.document.createElement("div")).append(e(e.mosaic.document.createElement("div")).addClass("mosaic-innergrid-outer-border"))).append(r)).mosaicAddMouseMoveInnergridRow(),i.each(["top","bottom"],function(t){r.append(e(e.mosaic.document.createElement("div")).addClass("mosaic-divider mosaic-divider-"+t).append(e(e.mosaic.document.createElement("div")).addClass("mosaic-divider-dot")))})),"top"===n)s.before(r);else if("bottom"===n)s.after(r);else if("left"===n||"right"===n)if(1===s.parent().parent().children(".mosaic-grid-cell").length){var d=s.prevAll();d.length>0&&(s.parent().parent().before(e(e.mosaic.document.createElement("div")).addClass("mosaic-grid-row").append(e(e.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-full mosaic-position-leftmost").append(e(d.get().reverse()).clone(!0).mosaicAddDrag()))),d.remove());var m=s.nextAll();m.length>0&&(s.parent().parent().after(e(e.mosaic.document.createElement("div")).addClass("mosaic-grid-row").append(e(e.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-full mosaic-position-leftmost").append(m.clone(!0).mosaicAddDrag()))),m.remove()),s.parent().removeClass(e.mosaic.layout.widthClasses.join(" ")).removeClass(e.mosaic.layout.positionClasses.join(" ")).addClass("mosaic-width-half"),"left"===n?s.parent().addClass("mosaic-position-half").before(e(e.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-half mosaic-position-leftmost").append(l.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile"))):s.parent().addClass("mosaic-position-leftmost").after(e(e.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-half mosaic-position-half").append(l.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile"))),s.parent().parent().mosaicSetResizeHandles()}else"left"===n?s.parent().before(e(e.mosaic.document.createElement("div")).addClass("mosaic-grid-cell").append(l.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile"))):s.parent().after(e(e.mosaic.document.createElement("div")).addClass("mosaic-grid-cell").append(l.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile"))),s.parent().parent().mosaicSetColumnSizes(),s.parent().parent().mosaicSetResizeHandles()}var u=l.parent().parent();e(".mosaic-original-tile",e.mosaic.document).remove(),e.mosaic.options.panels.find(".mosaic-grid-row:not(:has(.mosaic-tile))").remove(),e.mosaic.options.panels.find(".mosaic-empty-row").remove(),u.mosaicCleanupRow(),e.mosaic.options.panels.mosaicAddEmptyRows();var p=e(".mosaic-new-tile",e.mosaic.document);p.removeClass("mosaic-new-tile");var h=new t(p),f=l.find(".mosaic-tile-content");f.size()>0&&f[0]._preScanHTML&&h.cacheHtml(f[0]._preScanHTML),h.isRichText()||h.scanRegistry(),e('.mosaic-tile:not(".mosaic-helper-tile") .mosaic-tile-content.mosaic-rich-text').each(function(){new t(e(this).parent()).setupWysiwyg()}),h.blur(),c&&h.focus()},e.fn.mosaicSetColumnSizes=function(){return this.each(function(){var t=e(this).children(".mosaic-grid-cell").length;e(this).children(".mosaic-grid-cell").each(function(a){switch(e(this).removeClass(e.mosaic.layout.widthClasses.join(" ")).removeClass(e.mosaic.layout.positionClasses.join(" ")),t){case 1:e(this).addClass("mosaic-width-full mosaic-position-leftmost");break;case 2:switch(a){case 0:e(this).addClass("mosaic-width-half mosaic-position-leftmost");break;case 1:e(this).addClass("mosaic-width-half mosaic-position-half")}break;case 3:switch(a){case 0:e(this).addClass("mosaic-width-third mosaic-position-leftmost");break;case 1:e(this).addClass("mosaic-width-third mosaic-position-third");break;case 2:e(this).addClass("mosaic-width-third mosaic-position-two-thirds")}break;case 4:switch(a){case 0:e(this).addClass("mosaic-width-quarter mosaic-position-leftmost");break;case 1:e(this).addClass("mosaic-width-quarter mosaic-position-quarter");break;case 2:e(this).addClass("mosaic-width-quarter mosaic-position-half");break;case 3:e(this).addClass("mosaic-width-quarter mosaic-position-three-quarters")}}})})},e.fn.mosaicSetResizeHandles=function(){return this.each(function(){switch(e(this).children(".mosaic-resize-handle").remove(),e(this).children(".mosaic-grid-cell").length){case 2:e(this).append(e(e.mosaic.document.createElement("div")).addClass("mosaic-resize-handle mosaic-resize-handle-center mosaic-resize-handle-one "+e(e(this).children(".mosaic-grid-cell").get(1)).mosaicGetPositionClass().replace("position","resize")));break;case 3:e(this).append(e(e.mosaic.document.createElement("div")).addClass("mosaic-resize-handle mosaic-resize-handle-center mosaic-resize-handle-one "+e(e(this).children(".mosaic-grid-cell").get(1)).mosaicGetPositionClass().replace("position","resize"))),e(this).append(e(e.mosaic.document.createElement("div")).addClass("mosaic-resize-handle mosaic-resize-handle-center mosaic-resize-handle-two "+e(e(this).children(".mosaic-grid-cell").get(2)).mosaicGetPositionClass().replace("position","resize")))}e(this).children(".mosaic-resize-handle").mousedown(function(){var t=[];e(this).parent().children(".mosaic-grid-cell").each(function(){switch(e(this).mosaicGetWidthClass()){case"mosaic-width-half":t.push("50");break;case"mosaic-width-quarter":t.push("25");break;case"mosaic-width-third":t.push("33");break;case"mosaic-width-two-thirds":t.push("66");break;case"mosaic-width-three-quarters":t.push("75")}e(this).parent().append(e(e.mosaic.document.createElement("div")).addClass("mosaic-resize-placeholder "+e(this).mosaicGetWidthClass()+" "+e(this).mosaicGetPositionClass().replace("position","resize")).append(e(e.mosaic.document.createElement("div")).addClass("mosaic-resize-placeholder-inner-border")))});var a=1;return e(this).hasClass("mosaic-resize-handle-two")&&(a=2),e(this).parent().append(e(e.mosaic.document.createElement("div")).addClass("mosaic-resize-handle mosaic-resize-handle-helper").addClass(e(this).mosaicGetPositionClass().replace("position","resize")).data("row_width",e(this).parent().width()).data("nr_of_columns",e(this).parent().children(".mosaic-grid-cell").length).data("column_sizes",t.join(" ")).data("resize_handle_index",a)),e(this).parents("[data-panel]").addClass("mosaic-panel-resizing"),e(this).parent().addClass("mosaic-row-resizing"),e(".mosaic-selected-tile",e.mosaic.document).children(".mosaic-tile-content").blur(),!1})})},e.fn.mosaicCleanupRow=function(){return this.each(function(){var t=e(this);if(t.children(".mosaic-grid-cell").each(function(){0===e(this).children().length&&(e(this).remove(),t.mosaicSetColumnSizes())}),0===t.find(".mosaic-tile").length){var a=t;if(t.nextAll(".mosaic-grid-row").length>0)t=t.next(".mosaic-grid-row");else{if(!(t.prevAll(".mosaic-grid-row").length>0))return void t.remove();t=t.prev(".mosaic-grid-row")}a.remove()}t.mosaicSetResizeHandles()})},e.fn.mosaicSetResizeHandleLocation=function(){e(this).children(".mosaic-grid-row").each(function(){var t=e(this),a=t.children(".mosaic-grid-cell");2!==a.length&&3!==a.length||(t.children(".mosaic-resize-handle").removeClass("mosaic-resize-handle-left mosaic-resize-handle-center mosaic-resize-handle-right"),e(a.get(0)).children(".mosaic-tile").hasClass("mosaic-selected-tile")?(t.children(".mosaic-resize-handle-one").addClass("mosaic-resize-handle-left"),t.children(".mosaic-resize-handle-two").addClass("mosaic-resize-handle-center")):e(a.get(1)).children(".mosaic-tile").hasClass("mosaic-selected-tile")?(t.children(".mosaic-resize-handle-one").addClass("mosaic-resize-handle-right"),t.children(".mosaic-resize-handle-two").addClass("mosaic-resize-handle-left")):3===a.length&&e(a.get(2)).children(".mosaic-tile").hasClass("mosaic-selected-tile")?(t.children(".mosaic-resize-handle-one").addClass("mosaic-resize-handle-center"),t.children(".mosaic-resize-handle-two").addClass("mosaic-resize-handle-right")):(t.children(".mosaic-resize-handle-one").addClass("mosaic-resize-handle-center"),t.children(".mosaic-resize-handle-two").addClass("mosaic-resize-handle-center")))})},e.fn.mosaicGetDirection=function(t){var a=parseFloat(e(this).width()),i=parseFloat(e(this).height()),o=parseFloat(t.pageX-e(this).offset().left-a/2),s=parseFloat(t.pageY-e(this).offset().top-i/2),n=a/2,c=i/2;return o<0?s<0?o/s<-1*n/(-1*c)?"top":"left":o/s<-1*n/c?"left":"bottom":s<0?o/s<1*n/(-1*c)?"right":"top":o/s<n/c?"bottom":"right"},e.mosaic.disableEditHtmlSource=function(){e(".mosaic-rich-text-textarea",e.mosaic.document).each(function(){var a,i;i=e(this).val(),a=e(this).parent(),a.html(i),new t(e(this).parent()).setupWysiwyg()})},e.mosaic.addAppTile=function(t,a){e.mosaic.overlay.app&&e.mosaic.overlay.app.hide(),e.ajax({type:"GET",url:a,success:function(i){i=e.mosaic.getDomTreeFromHtml(i),e.mosaic.addHeadTags(a,i),e.mosaic.addTile(t,i.find(".temp_body_tag").html(),a)}})},e.mosaic.addAppTileHTML=function(t,a,i){var o;o=e.mosaic.getDomTreeFromHtml(a),e.mosaic.addHeadTags(i,o),e.mosaic.addTile(t,o.find(".temp_body_tag").html(),i)},e.mosaic.editAppTile=function(t){e.mosaic.overlay.close(),window.parent.focus(),e.ajax({type:"GET",url:t,success:function(a){a=e.mosaic.getDomTreeFromHtml(a),e.mosaic.removeHeadTags(t),e.mosaic.addHeadTags(t,a);var i=e(".mosaic-selected-tile .mosaic-tile-content",e.mosaic.document);i.html(a.find(".temp_body_tag").html()),i.attr("data-tileUrl",t.replace(/&/gim,"&amp;"))}})},e.mosaic.addTile=function(a,i,o){e.mosaic.options.panels.addClass("mosaic-panel-dragging mosaic-panel-dragging-new"),e(e.mosaic.options.panels.get(0)).append(e(e.mosaic.document.createElement("div")).addClass("mosaic-grid-row").append(e(e.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-half mosaic-position-leftmost").append(e(e.mosaic.document.createElement("div")).addClass("movable removable mosaic-tile mosaic-"+a+"-tile").append(e(e.mosaic.document.createElement("div")).addClass("mosaic-tile-content").attr("data-tileUrl",o&&o.replace(/&/gim,"&amp;")).html(i)).addClass("mosaic-helper-tile mosaic-helper-tile-new mosaic-original-tile"))));var s=e.mosaic.options.panels.find(".mosaic-helper-tile-new"),n=0;e.mosaic.options.panels.each(function(){e(this).width()>n&&(n=e(this).width())}),s.width()<n/4?s.width(n/4):s.width(s.width());var c=new t(s);c.initialize(),c.cacheHtml(),c.scanRegistry()},e.mosaic.getDefaultValue=function(t){var a,i,o,s;switch("IDublinCore-title"===t.name?(o='<h1 class="documentFirstHeading">',s="</h1>"):"IDublinCore-description"===t.name?(o='<p class="documentDescription">',s="</p>"):(o="<div>",s="</div>"),t.tile_type){case"field":switch(t.widget){case"z3c.form.browser.text.TextWidget":case"z3c.form.browser.text.TextFieldWidget":return o+e("#"+t.id,e.mosaic.document).find("input").attr("value")+s;case"z3c.form.browser.textarea.TextAreaWidget":case"z3c.form.browser.textarea.TextAreaFieldWidget":case"z3c.form.browser.textlines.TextLinesWidget":case"z3c.form.browser.textlines.TextLinesFieldWidget":for(var n=e("#"+t.id,e.mosaic.document).find("textarea").val().split("\n"),c="",l=0;l<n.length;l+=1)c+=n[l]+"<br/>";return o+c+s;case"plone.app.z3cform.widget.RichTextFieldWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget":case"plone.app.widgets.dx.RichTextWidget":if(a=e("#"+t.id).find("textarea").attr("id"),!(i=tinymce.get(a)))return"";try{return i.getContent()}catch(e){return'<div class="discreet">Placeholder for field:<br/><b>'+t.label+"</b></div>"}break;default:return'<div class="discreet">Placeholder for field:<br/><b>'+t.label+"</b></div>"}break;default:return t.default_value}},e.mosaic.getPageContent=function(a){var i,o=function(i){var c="";return!1===e(i).hasClass("mosaic-empty-row")&&e(i).find(".mosaic-tile").length>=0&&(l=e(i).attr("class"),c+='      <div class="'+l+'">\n',e(i).children(".mosaic-grid-cell").each(function(){switch(e(this).mosaicGetPositionClass()){case"mosaic-position-leftmost":s=1;break;case"mosaic-position-quarter":s=4;break;case"mosaic-position-third":s=5;break;case"mosaic-position-half":s=7;break;case"mosaic-position-two-thirds":s=9;break;case"mosaic-position-three-quarters":s=10}switch(e(this).mosaicGetWidthClass()){case"mosaic-width-half":n=6;break;case"mosaic-width-quarter":n=3;break;case"mosaic-width-third":n=4;break;case"mosaic-width-two-thirds":n=8;break;case"mosaic-width-three-quarters":n=9;break;case"mosaic-width-full":n=12}c+='        <div class="'+e(this).attr("class")+'">\n',e(this).children().each(function(){if(e(this).hasClass("mosaic-tile")){var i=new t(this);c+=i.getHtmlBody(a)}else e(this).hasClass("mosaic-innergrid-row")&&(c+=o(this))}),c+="        </div>\n"}),c+="      </div>\n"),c},s=1,n=12,c="",l="";return e.mosaic.disableEditHtmlSource(),c+="  <body>\n",e("[data-panel]",e.mosaic.document).each(function(){c+='    <div data-panel="'+e(this).data("panel")+'"',c+='         data-max-columns="'+e(this).data("max-columns")+'">\n',e(this).children().each(function(){e(this).hasClass("mosaic-grid-row")&&(c+=o(this))}),c+="    </div>\n"}),c+="  </body>\n",i='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">\n<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" data-layout="'+e.mosaic.options.layout+'">\n',i+=c,i+="</html>\n"},e.mosaic.saveTileFormData=function(){e("[data-panel]",e.mosaic.document).each(function(){e(this).find(".mosaic-tile").each(function(){new t(this).saveForm()})})},e.mosaic.saveLayoutToForm=function(){e.mosaic.saveTileFormData();var t=e("#form-widgets-ILayoutAware-customContentLayout, [name='form.widgets.ILayoutAware.customContentLayout']");e.mosaic.hasContentLayout?t.val(""):t.val(e.mosaic.getPageContent())},{Tile:t}}),define("mosaic-url/mosaic.toolbar",["jquery","mosaic-url/mosaic.tile","mosaic-url/mosaic.layout"],function(e,t){"use strict";function a(t,a){var o;void 0!==typeof a.menu&&a.menu?a.icon?(o=e(document.createElement("label")),t.append(o.addClass("mosaic-icon-menu mosaic-icon-menu-"+i(a.name)+" mosaic-icon").html(a.label).attr("title",a.label).append(e(document.createElement("select")).addClass("mosaic-menu-"+i(a.name)).data("action",a.action).change(function(){e(this).mosaicExecAction()}).each(function(){var t,o,s;for(t in a.items)if(void 0!==a.items[t].items){e(this).append(e(document.createElement("optgroup")).addClass("mosaic-option-group mosaic-option-group-"+i(a.items[t].value)).attr("label",a.items[t].label)),o=e(this).find(".mosaic-option-group-"+i(a.items[t].value));for(s in a.items[t].items)o.append(e(document.createElement("option")).attr("value",a.items[t].items[s].value).addClass("mosaic-option mosaic-option-"+i(a.items[t].items[s].value)).html(a.items[t].items[s].label))}else e(this).append(e(document.createElement("option")).attr("value",a.items[t].value).addClass("mosaic-option mosaic-option-"+i(a.items[t].value)).html(a.items[t].label))})))):(o=e(document.createElement("select")),t.append(o.addClass("mosaic-menu mosaic-menu-"+a.name.replace(/_/g,"-")).data("action",a.action).change(function(){e(this).mosaicExecAction()}).each(function(){var t,o,s;for(t=0;t<a.items.length;t+=1)if(void 0!==a.items[t].items){e(this).append(e(document.createElement("optgroup")).addClass("mosaic-option-group mosaic-option-group-"+i(a.items[t].value)).attr("label",a.items[t].label)),o=e(this).find(".mosaic-option-group-"+i(a.items[t].value));for(s in a.items[t].items)o.append(e(document.createElement("option")).attr("value",a.items[t].items[s].value).addClass("mosaic-option mosaic-option-"+i(a.items[t].items[s].value)).html(a.items[t].items[s].label))}else e(this).append(e(document.createElement("option")).attr("value",a.items[t].value).addClass("mosaic-option mosaic-option-"+i(a.items[t].value)).html(a.items[t].label))}))):(o=e(document.createElement("button")),t.append(o.addClass("mosaic-button mosaic-button-"+i(a.name)+(a.icon?" mosaic-icon":"")).html(a.label).attr("title",a.label).attr("type","button").data("action",a.action).mousedown(function(){e(this).mosaicExecAction()}))),e.mosaic.actionManager.actions[a.name]&&(e.mosaic.actionManager.actions[a.name].visible()||o.hide())}void 0===e.mosaic&&(e.mosaic={});var i=function(e){return e.replace(/(_|\.|\/)/g,"-").toLowerCase()};e.fn._mosaicToolbarLayoutEditor=function(t){e(".mosaic-toolbar-secondary-functions",this).show();var o,s,n,c;if(void 0!==e.mosaic.options.formats)for(o=0;o<e.mosaic.options.formats.length;o+=1){for(n=e.mosaic.options.formats[o],t.primary_actions.append(e(document.createElement("fieldset")).addClass("mosaic-button-group mosaic-button-group-"+i(n.name))),c=t.primary_actions.children(".mosaic-button-group-"+n.name.replace(/_/g,"-")),s=0;s<n.actions.length;s+=1)n.actions[s].favorite&&a(c,n.actions[s]);0===c.children().length&&c.remove()}if(void 0!==e.mosaic.options.tiles){var l=t.secondary_actions.find(".mosaic-menu-insert");for(o=0;o<e.mosaic.options.tiles.length;o+=1){for(n=e.mosaic.options.tiles[o],l.append(e(document.createElement("optgroup")).addClass("mosaic-option-group mosaic-option-group-"+i(n.name)).attr("label",n.label)),c=t.secondary_actions.find(".mosaic-option-group-"+i(n.name)),s=0;s<n.tiles.length;s+=1){var r=n.tiles[s];c.append(e(document.createElement("option")).addClass("mosaic-option mosaic-option-"+i(r.name)).attr("value",r.name).html(r.label))}0===c.children().length&&c.remove()}}if(void 0!==e.mosaic.options.formats){var d=t.secondary_actions.find(".mosaic-menu-format");for(o=0;o<e.mosaic.options.formats.length;o+=1){for(n=e.mosaic.options.formats[o],d.append(e(document.createElement("optgroup")).addClass("mosaic-option-group mosaic-option-group-"+i(n.name)).attr("label",n.label)),c=t.secondary_actions.find(".mosaic-option-group-"+i(n.name)),s=0;s<n.actions.length;s+=1){var m=n.actions[s];!1===m.favorite&&c.append(e(document.createElement("option")).addClass("mosaic-option mosaic-option-"+i(m.name)).attr("value",m.name).html(m.label).data("action",m.action))}0===c.children().length&&c.remove()}}},e.fn.mosaicToolbar=function(){return this.each(function(){var o,s,n,c,l,r,d,m,u;o=e(this),o.html(""),o.append(e(document.createElement("div")).addClass("mosaic-inline-toolbar")),o=o.children(".mosaic-inline-toolbar"),o.append(e(document.createElement("div")).addClass("mosaic-toolbar-content")),s=o.children(".mosaic-toolbar-content"),n={},s.append(e(document.createElement("div")).addClass("mosaic-toolbar-primary-functions")),n.primary_actions=s.children(".mosaic-toolbar-primary-functions"),s.append(e(document.createElement("div")).addClass("mosaic-toolbar-secondary-functions")),n.secondary_actions=s.children(".mosaic-toolbar-secondary-functions");for(c in n)for(l=0;l<e.mosaic.options[c].length;l+=1)if(void 0===e.mosaic.options[c][l].actions)a(n[c],e.mosaic.options[c][l]);else{r=e.mosaic.options[c][l];var p=i(e.mosaic.options[c][l].name),h=e(document.createElement("div")).addClass("mosaic-button-group mosaic-button-group-"+p);h.append(a(h,e.extend({},!0,r,{action:r.name.toLowerCase(),name:r.name.toLowerCase()})));var f=e(document.createElement("div")).addClass("btn-container");for(h.append(f),n[c].append(h),d=0;d<r.actions.length;d+=1)a(f,r.actions[d])}o._mosaicToolbarLayoutEditor(n),e.mosaic.hasContentLayout&&e(".mosaic-toolbar-secondary-functions",this).hide(),m=function(){var t;parseInt(e(window).scrollTop(),10)>parseInt(o.parent().offset().top,10)?o.hasClass("mosaic-inline-toolbar")&&(t=o.offset().left,o.width(o.width()).css({left:t,"margin-left":"0px"}).removeClass("mosaic-inline-toolbar").addClass("mosaic-external-toolbar").parent().height(o.height())):o.hasClass("mosaic-external-toolbar")&&o.css({width:"",left:"","margin-left":""}).removeClass("mosaic-external-toolbar").addClass("mosaic-inline-toolbar").parent().css("height","")},e(window).bind("scroll",m),u=function(){var a,i,o,s,n,c;e.mosaic.disableEditHtmlSource(),a=e(this);var l=e(".mosaic-selected-tile",e.mosaic.document);if(l.length>0){i=new t(l).getType()}for(o=e.mosaic.options.default_available_actions,s=0;s<e.mosaic.options.tiles.length;s+=1)for(n=e.mosaic.options.tiles[s],c=0;c<n.tiles.length;c+=1)n.tiles[c].name===i&&(o=o.concat(n.tiles[c].available_actions));l.hasClass("removable")||(o=e(o).filter(function(){return"remove"!==this})),a.find(".mosaic-option-group").show(),a.find(".mosaic-button").hide(),a.find(".mosaic-menu-format").find(".mosaic-option").hide().attr("disabled","disabled"),e(a.find(".mosaic-menu-format").find(".mosaic-option").get(0)).show().removeAttr("disabled"),e(o).each(function(t,i){e.mosaic.actionManager.actions[i]&&!e.mosaic.actionManager.actions[i].visible()||(a.find(".mosaic-button-"+i).show(),a.find(".mosaic-icon-menu-"+i).show(),a.find(".select2-container.mosaic-menu-"+i).show(),a.find(".mosaic-option-"+i).show().removeAttr("disabled"))}),e.mosaic.actionManager.actions.layout.visible()&&e(".mosaic-button-layout").show(),a.find(".mosaic-menu-insert").children(".mosaic-option-group-fields").children().each(function(){0===e.mosaic.options.panels.find(".mosaic-"+e(this).attr("value")+"-tile").length?e(this).show().removeAttr("disabled"):e(this).hide().attr("disabled","disabled")}),a.find(".mosaic-option-group").each(function(){0===e(this).children(":enabled").length&&e(this).hide()}),!e.mosaic.hasContentLayout&&e.mosaic.options.canChangeLayout?e(".mosaic-button-savelayout").show():e(".mosaic-button-savelayout").hide()},e(this).bind("selectedtilechange",u),e(this).trigger("selectedtilechange"),e(".mosaic-menu").each(function(){e(this).select2({width:"style",dropdownCssClass:"mosaic-dropdown mosaic-dropdown-"+e(this).data("action"),dropdownAutoWidth:!0,minimumResultsForSearch:99})});var g=(new Date).getTime();e(this).on("selectedtilechange",function(){e.mosaic.overlay.app||e.mosaic.saving||e.mosaic.modal||(new Date).getTime()-g>6e3&&(e.mosaic.queue(function(t){e.mosaic.saveLayoutToForm(),e("#form-widgets-ILayoutAware-customContentLayout, [name='form.widgets.ILayoutAware.customContentLayout']").blur(),t()}),g=(new Date).getTime())})})}}),define("mosaic-url/mosaic.actions",["jquery","mosaic-url/mosaic.tile","mockup-utils","mockup-patterns-modal"],function(e,t,a,i){"use strict"
;void 0===e.mosaic&&(e.mosaic={}),e.mosaic.actionManager={actions:[],shortcuts:[]},e.mosaic.registerAction=function(t,a){a=e.extend({exec:function(){},shortcut:{ctrl:!1,alt:!1,shift:!1,key:""},visible:function(e){return!0}},a),e.mosaic.actionManager.actions[t]=a,""!==a.shortcut.key&&(a.shortcut.charCode=a.shortcut.key.toUpperCase().charCodeAt(0),a.shortcut.action=t,e.mosaic.actionManager.shortcuts.push(a.shortcut))},e.fn.mosaicExecAction=function(){return this.each(function(){if(""!==e(this).data("action")){e.mosaic.actionManager.actions[e(this).data("action")].exec(this)}})},e.mosaic.fixWebkitSpan=function(){var t=e(".Apple-style-span",e.mosaic.document);t.after(t.html()),t.remove()},e.mosaic.getPrefixedClassName=function(e){return e.indexOf("-")>-1?"mosaic-"+e:"mosaic"+e.charAt(0).toUpperCase()+e.slice(1)},e.mosaic.initActions=function(){e.mosaic.registerAction("tile-toggle-class",{exec:function(){var t;arguments.length>0&&arguments[0].value&&(t=e.mosaic.getPrefixedClassName(arguments[0].value),e(".mosaic-selected-tile",e.mosaic.document).toggleClass(t))}}),e.mosaic.registerAction("tile-remove-format",{exec:function(){var t,a,i,o,s;for(t=0;t<e.mosaic.options.formats.length;t++)for(i=e.mosaic.options.formats[t],a=0;a<i.actions.length;a++)o=i.actions[a],"tile"===o.category&&(s=e.mosaic.getPrefixedClassName(o.name),e(".mosaic-selected-tile",e.mosaic.document).removeClass(s))}}),e.mosaic.registerAction("row-toggle-class",{exec:function(){var t;arguments.length>0&&arguments[0].value&&(t=e.mosaic.getPrefixedClassName(arguments[0].value),e(".mosaic-selected-tile",e.mosaic.document).parents(".mosaic-grid-row").first().toggleClass(t))}}),e.mosaic.registerAction("row-remove-format",{exec:function(){var t,a,i,o,s;for(t=0;t<e.mosaic.options.formats.length;t++)for(i=e.mosaic.options.formats[t],a=0;a<i.actions.length;a++)o=i.actions[a],"row"===o.category&&(s=e.mosaic.getPrefixedClassName(o.name),e(".mosaic-selected-tile",e.mosaic.document).parents(".mosaic-grid-row").first().removeClass(s))}}),e.mosaic.registerAction("tile-align-block",{exec:function(){e(".mosaic-selected-tile",e.mosaic.document).removeClass("mosaic-tile-align-right").removeClass("mosaic-tile-align-left")},shortcut:{ctrl:!0,alt:!1,shift:!0,key:"b"}}),e.mosaic.registerAction("tile-align-left",{exec:function(){e(".mosaic-selected-tile",e.mosaic.document).removeClass("mosaic-tile-align-right").addClass("mosaic-tile-align-left")},shortcut:{ctrl:!0,alt:!1,shift:!0,key:"l"}}),e.mosaic.registerAction("tile-align-right",{exec:function(){e(".mosaic-selected-tile",e.mosaic.document).removeClass("mosaic-tile-align-left").addClass("mosaic-tile-align-right")},shortcut:{ctrl:!0,alt:!1,shift:!0,key:"r"}}),e.mosaic.registerAction("save",{exec:function(){e.mosaic.saving=!0,e(".mosaic-selected-tile",e.mosaic.document).each(function(){new t(this).blur()}),e.mosaic.options.toolbar.trigger("selectedtilechange"),e.mosaic.queue(function(t){e.mosaic.saveLayoutToForm(),e("#form-buttons-save").click(),e.mosaic.saving=!1,t()})},shortcut:{ctrl:!0,alt:!1,shift:!1,key:"s"}}),e.mosaic.registerAction("cancel",{exec:function(){e("#form-buttons-cancel").click()}}),e.mosaic.registerAction("preview",{exec:function(){e("#form-widgets-ILayoutAware-customContentLayout, [name='form.widgets.ILayoutAware.customContentLayout']").focus().blur(),setTimeout(function(){window.open(e.mosaic.options.context_url+"/@@layout_preview","_blank")},1e3)}}),e.mosaic.registerAction("html",{exec:function(){var t,a,i;t=e(".mosaic-selected-tile",e.mosaic.document).children(".mosaic-tile-content"),0===t.find(".mosaic-rich-text-textarea").length&&(a=t.html(),i=t.height(),t.empty(),t.prepend(e(e.mosaic.document.createElement("textarea")).addClass("mosaic-rich-text-textarea").html(e.trim(a)).height(i)))}}),e.mosaic.registerAction("properties",{exec:function(){e.mosaic.overlay.open("all")}}),e.mosaic.registerAction("layout",{exec:function(){e(".mosaic-button-group-layout").toggleClass("active")},visible:function(){return!0}}),e.mosaic.registerAction("customizelayout",{exec:function(){e.mosaic.setSelectedContentLayout(""),e(".mosaic-toolbar-secondary-functions").show(),e(".mosaic-button-customizelayout").hide(),e(".mosaic-button-savelayout").show(),e(".mosaic-panel .mosaic-tile",e.mosaic.document).each(function(){var e=new t(this);e.makeMovable(),e.$el.mosaicAddDrag()}),e(".mosaic-button-group-layout").removeClass("active")},visible:function(){return e.mosaic.hasContentLayout&&e.mosaic.options.canChangeLayout}}),e.mosaic.registerAction("changelayout",{exec:function(){var t=e.mosaic.hasContentLayout;t||(t=confirm("Changing your layout will destroy all existing custom layout settings you have in place. Are you sure you want to continue?")),t&&e.mosaic.selectLayout(),e(".mosaic-button-group-layout").removeClass("active")},visible:function(){return e.mosaic.options.available_layouts.length>0}}),e.mosaic.registerAction("savelayout",{exec:function(){e.mosaic.saveLayout(),e(".mosaic-button-group-layout").removeClass("active")},visible:function(){return!0}}),e.mosaic.registerAction("add-tile",{exec:function(){new i(e(".mosaic-toolbar"),{ajaxUrl:e.mosaic.options.context_url+"/@@add-tile?form.button.Create=Create"}).show()}}),e.mosaic.registerAction("format",{exec:function(t){e(t).find("[value="+e(t).val()+"]").mosaicExecAction(),e(t).select2("val","none")}}),e.mosaic.registerAction("insert",{exec:function(t){var o,s,n,c,l;if("none"===e(t).val())return!1;for(n=e(t).val(),e(".mosaic-selected-tile",e.mosaic.document).removeClass("mosaic-selected-tile").children(".mosaic-tile-content").blur(),e.mosaic.options.panels.trigger("selectedtilechange"),c=0;c<e.mosaic.options.tiles.length;c+=1)for(s=e.mosaic.options.tiles[c],l=0;l<s.tiles.length;l+=1)s.tiles[l].name===n&&(o=s.tiles[l]);if("textapp"===o.tile_type){var r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),d=e.mosaic.options.context_url+"/@@"+n+"/"+r,m="<html><body>"+e.mosaic.getDefaultValue(o)+"</body></html>";e.mosaic.addAppTileHTML(n,m,d)}else if("app"===o.tile_type){var u=!0;a.loading.show(),e.ajax({type:"GET",url:e.mosaic.options.context_url+"/@@add-tile?tiletype="+n+"&form.button.Create=Create",success:function(t,o){a.loading.hide();var s,c,l,r;s=e(t),c=s.find("#add_tile").attr("action"),l=s.find('[name="_authenticator"]').val(),r=function(t){e.mosaic.overlay.app=new i(e(".mosaic-toolbar"),{html:t,loadLinksWithinModal:!0,buttons:'.formControls > input[type="submit"], .actionButtons > input[type="submit"]'}),e.mosaic.overlay.app.$el.off("after-render"),e.mosaic.overlay.app.on("after-render",function(t){u&&(e(".field.error",e.mosaic.overlay.app.$modal).removeClass("error"),e(".fieldErrorBox,.portalMessage",e.mosaic.overlay.app.$modal).remove(),u=!1),e('input[name*="cancel"]',e.mosaic.overlay.app.$modal).off("click").on("click",function(){e.mosaic.overlay.app.hide(),e.mosaic.overlay.app=null})}),e.mosaic.overlay.app.show(),e.mosaic.overlay.app.$el.off("formActionSuccess"),e.mosaic.overlay.app.on("formActionSuccess",function(t,a,i,o){var s=o.getResponseHeader("X-Tile-Url");s&&(e.mosaic.addAppTileHTML(n,a,s),e.mosaic.overlay.app.hide(),e.mosaic.overlay.app=null)})},e("form .required",s).filter(function(){var t=e(this).parents(".field").first().find("input, select, textarea").not('[type="hidden"]').last().val();return null===t||0===t.length}).length>0?r(t):c&&e("form",s).ajaxSubmit({type:"POST",url:c,data:{"buttons.save":"Save",_authenticator:l},success:function(t,a,i){var o=i.getResponseHeader("X-Tile-Url");o?e.mosaic.addAppTileHTML(n,t,o):r(t)}})}})}else e.mosaic.addTile(n,e.mosaic.getDefaultValue(o));return e(t).select2("val","none"),!0}}),e(document).keypress(function(t){var a="";return e(e.mosaic.actionManager.shortcuts).each(function(){t.ctrlKey!==this.ctrl&&(-1===navigator.userAgent.toLowerCase().indexOf("macintosh")||t.metaKey!==this.ctrl)||t.altKey!==this.alt&&void 0!==t.altKey||t.shiftKey!==this.shift||!t.charCode||String.fromCharCode(t.charCode).toUpperCase().charCodeAt(0)!==this.charCode||(a=this.action)}),""===a||(e.mosaic.actionManager.actions[a].exec(),!1)})}}),define("mosaic-url/mosaic.core",["jquery","pat-logger","underscore","mosaic-url/mosaic.tile","mosaic-url/mosaic.panel","mockup-patterns-modal","mockup-utils","mosaic-url/mosaic.toolbar","mosaic-url/mosaic.layout","mosaic-url/mosaic.actions"],function(e,t,a,i,o,s,n){"use strict";t.getLogger("pat-mosaic");void 0===e.mosaic&&(e.mosaic={}),e.mosaic.loaded=!1,e.mosaic.saving=!1,e.mosaic.selectLayoutTemplate=a.template('<div><h1>Select Layout</h1><div class="mosaic-select-layout"><div class="global-layouts"><ul><% _.each(available_layouts, function(layout){ var screenshot = layout.preview || layout.screenshot;if(!screenshot){screenshot = "++plone++mosaic/img/default-layout-screenshot.png";} %><li><a href="#" data-value="<%- layout.path %>"><p><%- layout.title %></p><p class="mosaic-select-layout-description"><%- layout.description %></p><img src="<%- portal_url %>/<%- screenshot %>"></a></li><% }); %></ul></div><% if(user_layouts.length > 0){ %><div class="user-layouts"><h4>My Layouts</h4><ul><% _.each(user_layouts, function(layout){ var screenshot = layout.preview || layout.screenshot;if(!screenshot){screenshot = "++plone++mosaic/img/default-layout-screenshot.png";} %><li><a href="#" data-value="<%- layout.path %>"><p><%- layout.title %></p><img src="<%- portal_url %>/<%- screenshot %>"></a></li><% }); %></ul></div><% } %><% if(hasCustomLayouts && canChangeLayout) { %><p class="manage-custom-layouts"><a href="#" class="plone-btn plone-btn-default">Manage custom layouts</a></p><% } %></div><div class="buttons">\x3c!-- <button class="plone-btn plone-btn-default">Select</button> --\x3e</div></div>'),e.mosaic.saveLayoutTemplate=a.template('<div><h1>Save Layout</h1><div class="mosaic-save-layout"><p>This process takes a copy of the existing layout and saves it to a new, resuable layout.</p><div class="form-group field"><label for="layoutNameField">Name</label><input type="text" name="name" class="form-control" id="layoutNameField" /></div><% if(canManageLayouts){ %><div class="field form-group"><span class="option"><input id="globalLayout" type="checkbox"><label for="globalLayout"><span class="label">Global</span></label></span><div class="formHelp">Should this layout be available for all users on the site?</div></div><% } %></div><div class="buttons"><button class="plone-btn plone-btn-primary">Save</button></div></div>'),e.mosaic.manageLayoutsTemplate=a.template('<div><h1>Manage custom layouts</h1><div class="mosaic-manage-custom-layouts"><table><thead><tr><th>Name</th><th>Path</th><th>Actions</th></tr></thead><tbody><% _.each(available_layouts.concat(user_layouts), function(layout){ %><% if(layout.path.indexOf("custom/") !== -1){ %><% if(layout.path.split("/").length > 2 || canManageLayouts) { %><tr><td><%- layout.title %></td><td><%- layout.path %></td><td><a href="#" class="btn btn-danger delete-layout" data-layout="<%- layout.path %>">Delete</a></td></tr><% } %><% } %><% }); %></tbody></table></div></div>'),e.mosaic.deleteLayoutTemplate=a.template('<div><h1>Delete layout</h1><div class="mosaic-delete-layout"><% if(existing.length === 0 && !selected){  %><div class="portalMessage warning"><strong>Warning</strong>Are you certain you want to delete this layout? This can not be undone.</div><% } else { %><div class="portalMessage error"><strong>Warning</strong>Are you certain you want to delete this layout? This can not be undone. <% if(existing.length > 0) { %>There are currently <%- existing.length %> items assigned to this layout. <% } %>You need to provide a replacement layout for the existing items in order to delete this for items currently assigned to this.</div><div class="form-group field"><label for="layoutField">Replacement Layout</label><select name="layout" class="form-control" id="layoutField"><% _.each(available_layouts.concat(user_layouts), function(l){ %><% if(l.path !== layout_deleting.path){ %><option value="<%- l.path %>"><%- l.title %></option><% } %><% }); %></select></div><% } %></div><div class="buttons"><button class="plone-btn plone-btn-danger delete">Yes, delete</button><button class="plone-btn plone-btn-default cancel">No</button></div></div>'),e.mosaic.initialized=function(){e.mosaic.loaded||(e.mosaic.loaded=!0,n.loading.hide())},e.mosaic.init=function(t){t=e.extend({url:window.document.location.href,type:"",ignore_context:!1},t),e.mosaic.document=window.document;var a;e.mosaic.initActions(),a=t.url.match(/^([\w#!:.?+=&%@!\-\/]+)\/edit$/),a&&(t.url=a[1]),a=t.url.match(/^([\w#:.?=%@!\-\/]+)\/\+\+add\+\+([\w#!:.?+=&%@!\-\/]+)$/),a&&(t.url=a[1],t.type=a[2],t.ignore_context=!0),e.mosaic.options=t.data,e.mosaic.options.url=t.url,e.mosaic.options.ignore_context=t.ignore_context,e.mosaic.options.tileheadelements=[],e.mosaic.hasContentLayout=!0;var i=e.mosaic.getSelectedContentLayout();if(i)e.mosaic.applyLayout(i);else{var o=e(e.mosaic.options.customContentLayout_field_selector).val();if(o){var s=e.mosaic.getDomTreeFromHtml(o);"no-layout"===s.attr("id")?e.mosaic.selectLayout(!0):(e("body").addClass("mosaic-layout-customized"),e.mosaic.hasContentLayout=!1,e.mosaic._init(s));var n=e(".mosaic-helper-tile-new");n.length>0&&n.parents(".mosaic-grid-row").remove()}else e.mosaic.selectLayout(!0)}},e.mosaic.getSelectedContentLayout=function(){return e(e.mosaic.options.contentLayout_field_selector).val()},e.mosaic.setSelectedContentLayout=function(t){return t?(e.mosaic.hasContentLayout=!0,e(".mosaic-toolbar-secondary-functions",e.mosaic.document).hide(),e("body").removeClass("mosaic-layout-customized")):(e("body").addClass("mosaic-layout-customized"),e.mosaic.hasContentLayout=!1),e(e.mosaic.options.contentLayout_field_selector).attr("value",t)},e.mosaic._initPanels=function(t){e.mosaic.options.layout=t.attr("data-layout"),e("[data-panel] [data-panel]",e.mosaic.document).removeAttr("data-panel"),t.find("[data-panel]").each(function(){new o(this).initialize(t)}),e("[data-panel]",e.mosaic.document).each(function(){new o(this).prefill()}),e.mosaic.options.panels=e(".mosaic-panel",e.mosaic.document),e.mosaic.options.panels.find("[data-tile]").each(function(){if(i.validTile(this)){new i(e(this).parent()).initializeContent()}})},e.mosaic._init=function(t){e.mosaic._initPanels(t),e(".mosaic-original-content",e.mosaic.document).mosaicOverlay(),e("body").prepend(e(document.createElement("div")).addClass("mosaic-toolbar")),e.mosaic.options.toolbar=e(".mosaic-toolbar"),e.mosaic.options.toolbar.mosaicToolbar(),e.mosaic.options.panels.mosaicLayout(),e("*",e.mosaic.document).each(function(){var t;t=e(this),"block"!==t.css("display")&&"flex"!==t.css("display")||t.hasClass("mosaic-panel")||t.hasClass("mosaic-toolbar")||t.hasClass("mosaic-notifications")||t.hasClass("mosaic-modal-wrapper")||"edit-zone"===t.attr("id")||0===t.parents(".mosaic-panel, .mosaic-toolbar").length&&0===t.find(".mosaic-panel, .mosaic-toolbar").length&&0!==t.parent().find(".mosaic-panel, .mosaic-toolbar").length&&t.addClass("mosaic-blur")}),e(".pat-toolbar").hide();var a=e("body");a.addClass("mosaic-enabled"),a[0].className.split(" ").forEach(function(e){-1!==e.indexOf("plone-toolbar")&&a.removeClass(e)}),e.mosaic.initialized()},e.mosaic.applyLayout=function(t,a){void 0===a&&(a=function(){}),n.loading.show(),e.ajax({url:e("body").attr("data-portal-url")+"/"+t,cache:!1}).done(function(a){var i=e.mosaic.getDomTreeFromHtml(a);e.mosaic.setSelectedContentLayout(t),e.mosaic.loaded?(e.mosaic._initPanels(i),e.mosaic.options.panels.mosaicLayout()):e.mosaic._init(i)}).fail(function(t,a,i){"Not Found"===i?window.alert("Specified layout can not be found. Loading default layout."):window.alert("Error loading layout specified for this content. Falling back to basic layout."),e.mosaic.applyLayout("++contentlayout++default/basic.html")}).always(function(){n.loading.hide()})};var c=function(){return e.mosaic.options.user_layouts.length>0||a.filter(e.mosaic.options.available_layouts,function(e){return-1!==e.path.indexOf("custom/")}).length>0};e.mosaic._deleteLayout=function(t,a,i){var o=e("<div/>").appendTo("body"),c=new s(o,{html:e.mosaic.deleteLayoutTemplate(e.extend({},!0,{existing:a,layout_deleting:t,selected:e.mosaic.getSelectedContentLayout()==="++contentlayout++"+t.path},e.mosaic.options)),content:null,buttons:".plone-btn"});c.on("shown",function(){e("button.delete:visible",c.$modal).off("click").on("click",function(a){a.preventDefault(),n.loading.show();var o=e("#layoutField",c.$modal).val();e.ajax({url:e("body").attr("data-base-url")+"/@@manage-layouts-from-editor",data:{action:"deletelayout",layout:t.path,replacement:o,_authenticator:n.getAuthenticator()}}).done(function(a){c.hide(),i(a),o&&e.mosaic.getSelectedContentLayout()==="++contentlayout++"+t.path&&e.mosaic.applyLayout("++contentlayout++"+o)}).fail(function(){window.alert("Error deleting layout")}).always(function(){n.loading.hide()})}),e("button.cancel:visible",c.$modal).off("click").on("click",function(e){e.preventDefault(),c.hide()})}),c.show()},e.mosaic.deleteLayout=function(t,a){n.loading.show(),e.ajax({url:e("body").attr("data-base-url")+"/@@manage-layouts-from-editor",data:{action:"existing",layout:t.path}}).done(function(i){e.mosaic._deleteLayout(t,i.data,a)}).fail(function(){window.alert("Error loading data for existing assignments")}).always(function(){n.loading.hide()})},e.mosaic.manageCustomLayouts=function(){var t=e("<div/>").appendTo("body"),i=new s(t,{html:e.mosaic.manageLayoutsTemplate(e.extend({},!0,{},e.mosaic.options)),content:null,buttons:".plone-btn"});i.on("shown",function(){e(".delete-layout",i.$modal).off("click").on("click",function(t){t.preventDefault();var o=e(this).attr("data-layout");a.each(e.mosaic.options.available_layouts.concat(e.mosaic.options.user_layouts),function(t){if(t.path===o)return e.mosaic.deleteLayout(t,function(t){e.mosaic.options.available_layouts=t.available_layouts,e.mosaic.options.user_layouts=t.user_layouts,i.hide(),e.mosaic.manageCustomLayouts()})})})}),i.show()},e.mosaic.selectLayout=function(t){if(void 0!==t&&t&&1===e.mosaic.options.available_layouts.length){var i=e.mosaic.options.available_layouts[0],o="++contentlayout++"+i.directory+"/"+i.file;return void e.mosaic.applyLayout(o)}if(0===e.mosaic.options.available_layouts.length)return void e.mosaic.applyLayout("++contentlayout++default/basic.html");var n=e("<div/>").appendTo("body"),l=new s(n,{html:e.mosaic.selectLayoutTemplate(e.extend({},!0,{hasCustomLayouts:c(),portal_url:e("body").attr("data-portal-url")},e.mosaic.options)),content:null,buttons:".plone-btn"});l.on("shown",function(){e(".manage-custom-layouts a",l.$modal).off("click").on("click",function(t){t.preventDefault(),l.hide(),e.mosaic.manageCustomLayouts()}),e("li a",l.$modal).off("click").on("click",function(t){t.preventDefault();var i,o=e(this).attr("data-value");a.each(e.mosaic.options.available_layouts.concat(e.mosaic.options.user_layouts),function(e){e.path===o&&(i=e)});var s="++contentlayout++"+i.path;l.hide(),e.mosaic.applyLayout(s)})}),l.show()},e.mosaic.saveLayout=function(t){var a=e("<div/>").appendTo("body"),i=new s(a,{html:e.mosaic.saveLayoutTemplate(e.extend({},!0,{hasCustomLayouts:c()},e.mosaic.options)),content:null,buttons:".plone-btn"});i.on("shown",function(){e(".plone-btn:visible",i.$modal).off("click").on("click",function(t){var a=e("#layoutNameField",i.$modal).val();if(a){n.loading.show(),t.preventDefault();var o="false",s=e("#globalLayout",i.$modal);s.size()>0&&s[0].checked&&(o="true"),e.ajax({url:e("body").attr("data-base-url")+"/@@manage-layouts-from-editor",method:"POST",data:{action:"save",_authenticator:n.getAuthenticator(),global:o,name:a,layout:e.mosaic.getPageContent(!0)}}).done(function(t){t.success&&(e.mosaic.options.available_layouts=t.available_layouts,e.mosaic.options.user_layouts=t.user_layouts,e.mosaic.applyLayout(t.layout))}).fail(function(){window.alert("Error saving layout")}).always(function(){n.loading.hide(),i.hide()})}})}),i.show()},e.mosaic.getDomTreeFromHtml=function(t){return t=t.replace(/<!DOCTYPE[\w\s\- .\/\":]+>/,""),t=t.replace(/<html>/,'<div class="temp_html_tag">'),t=t.replace(/<\/html>/,"</div>"),t=t.replace(/<html\s/,'<div class="temp_html_tag" '),t=t.replace(/<\/html\s/,"</div "),t=t.replace(/<head>/,'<div class="temp_head_tag">'),t=t.replace(/<\/head>/,"</div>"),t=t.replace(/<head\s/,'<div class="temp_head_tag" '),t=t.replace(/<\/head\s/,"</div "),t=t.replace(/<body>/,'<div class="temp_body_tag">'),t=t.replace(/<\/body>/,"</div>"),t=t.replace(/<body\s/,'<div class="temp_body_tag" '),t=t.replace(/<\/body\s/,"</div "),e(e(t)[0])},e.mosaic.removeHeadTags=function(t){if(t&&"undefined"!==t){var a,i,o,s;if(t=t.split("?")[0],t=t.split("@@"),a=t[1].split("/"),t=t[0]+"@@delete-tile?type="+a[0]+"&id="+a[1]+"&confirm=true",i=a[0].replace(/\./g,"-")+"-"+a[1],o=e.mosaic.options.tileheadelements[i])for(s=0;s<o.length;s+=1)e(o[s],e.mosaic.document).remove();e.mosaic.options.tileheadelements[i]=[]}},e.mosaic.addHeadTags=function(t,a){var i,o;t=t.split("?")[0],t=t.split("@@"),i=t[1].split("/"),o=i[0].replace(/\./g,"-")+"-"+i[1],e.mosaic.options.tileheadelements[o]=[],a.find(".temp_head_tag").children().each(function(){e.mosaic.options.tileheadelements[o].push(this),e("head",e.mosaic.document).append(this)})},e.mosaic.queue=function(t,a){void 0===a&&(a=t,t="fx"),e(window).queue(t,a)}}),define("mosaic-url/mosaic.editor",["jquery"],function(e){"use strict";void 0===e.mosaic&&(e.mosaic={}),e.mosaic.editor={},e.mosaic.execCommand=function(e,t,a){tinymce.activeEditor&&tinymce.activeEditor.execCommand(e,t,a)},e.mosaic.editor.applyFormat=function(e){tinymce.activeEditor&&tinyMCE.activeEditor.formatter.apply(e)},e.mosaic.editor.registerFormat=function(e,t){tinymce.activeEditor&&tinymce.activeEditor.formatter.register(e,t)}}),define("mosaic-url/mosaic.overlay",["jquery"],function(e){"use strict";void 0===e.mosaic&&(e.mosaic={}),e.mosaic.overlay={},e.fn.mosaicOverlay=function(){return void 0===e.mosaic.overlay_hide_fields&&(e.mosaic.overlay_hide_fields=!0),this.each(function(){var t=e(this),a=e("form",t),i=e("h1",t),o=e('<div class="plone-modal-wrapper mosaic-overlay"><div class="mosaic-modal fade in" style="position: absolute; padding: 20px;"><div class="plone-modal-dialog"><div class="plone-modal-content"><div class="plone-modal-header"><a class="plone-modal-close">×</a></div><div class="plone-modal-body"></div><div class="plone-modal-footer"><div class="pattern-modal-buttons"></div></div></div></div></div></div>');e(".pat-tinymce",a).each(function(){if(e(this).data("pattern-tinymce"))try{e(this).data("pattern-tinymce").destroy()}catch(e){}}),e(".plone-modal-header",o).append("<h2>"+i.text()+"</h2>"),e(".plone-modal-body",o).append(a),e(document.body,e.mosaic.document).append(o),e(".pat-tinymce",a).each(function(){if(e(this).data("pattern-tinymce"))try{e(this).data("pattern-tinymce").init()}catch(e){}});try{e(".pat-textareamimetypeselector").change()}catch(e){}t.hide(),e(document.body,e.mosaic.document).prepend(e(document.createElement("div")).addClass("mosaic-overlay-blocker"))})},e.mosaic.overlay.open=function(t,a){var i,o,s,n,c,l,r,d;if(e(".mosaic-overlay").show().addClass("active"),e(".mosaic-overlay-blocker").show(),e("body").addClass("plone-modal-open"),i=e(".mosaic-overlay").find("form"),0===e(".mosaic-overlay-ok-button").length&&(e(".mosaic-overlay .formControls").children("input").hide(),e(".mosaic-overlay .pattern-modal-buttons").append(e(document.createElement("input")).attr({type:"button",value:"Done"}).addClass("mosaic-overlay-ok-button plone-btn plone-btn-primary").click(function(){e.mosaic.overlay.close()})),e(".mosaic-overlay .plone-modal-close").off("click").on("click",function(t){t.preventDefault(),e.mosaic.overlay.close()}),e(".mosaic-overlay .plone-modal-header h2").html("Properties")),"all"===t&&e.mosaic.overlay_hide_fields){for(o=i.find("nav"),o.removeClass("mosaic-hidden"),i.find("fieldset").children().removeClass("mosaic-hidden"),i.find("fieldset").removeClass("active"),o.find("a").removeClass("active"),i.find(e.mosaic.options.customContentLayout_selector).addClass("mosaic-hidden"),i.find(e.mosaic.options.contentLayout_selector).addClass("mosaic-hidden"),e(".mosaic-IDublinCore-title-tile").size()>0?i.find("#formfield-form-widgets-IDublinCore-title").addClass("mosaic-hidden"):i.find("#formfield-form-widgets-IDublinCore-title").removeClass("mosaic-hidden"),e(".mosaic-IDublinCore-description-tile").size()>0?i.find("#formfield-form-widgets-IDublinCore-description").addClass("mosaic-hidden"):i.find("#formfield-form-widgets-IDublinCore-description").removeClass("mosaic-hidden"),n=0;n<e.mosaic.options.tiles.length;n+=1)"fields"===e.mosaic.options.tiles[n].name&&(s=e.mosaic.options.tiles[n]);for(n=0;n<s.tiles.length;n+=1)l=s.tiles[n],0!==e.mosaic.options.panels.find(".mosaic-"+l.name+"-tile").length&&e(e.mosaic.document.getElementById(l.id)).addClass("mosaic-hidden");i.find("fieldset").each(function(){0===e(this).children("div:not(.mosaic-hidden)").length&&e("a[href=#fieldsetlegend-"+e(this).attr("id").split("-")[1]+"]").addClass("mosaic-hidden")}),c=o.children(":not(.mosaic-hidden)"),c.eq(0).addClass("active");var m=i.find("#fieldset-"+c.eq(0).attr("href").split("-")[1]);0===m.size()&&(m=i.find("fieldset:not(.mosaic-hidden)").eq(0)),m.addClass("active")}else"field"===t&&(r=e("#"+a.id),d=r.parents("fieldset"),i.find("fieldset").removeClass("active"),d.addClass("active"),d.children().addClass("mosaic-hidden"),r.removeClass("mosaic-hidden"),i.find("nav").addClass("mosaic-hidden"))},e.mosaic.overlay.close=function(){e(".mosaic-overlay").hide().removeClass("active"),e(".mosaic-overlay-blocker").hide(),e("body").removeClass("plone-modal-open")}}),window.DEBUG=!0,require(["jquery","pat-base","mosaic-url/mosaic.core","mosaic-url/mosaic.layout","mosaic-url/mosaic.toolbar","mosaic-url/mosaic.actions","mosaic-url/mosaic.editor","mosaic-url/mosaic.overlay"],function(e,t){"use strict";return t.extend({name:"layout",trigger:".pat-layout",parser:"mockup",defaults:{attribute:"class"},init:function(){var t=this;t.options.data.$el=t.$el,e.mosaic.init({data:t.options.data})}})}),define("mosaic.pattern",function(){});

//# sourceMappingURL=plone-mosaic.js.map
