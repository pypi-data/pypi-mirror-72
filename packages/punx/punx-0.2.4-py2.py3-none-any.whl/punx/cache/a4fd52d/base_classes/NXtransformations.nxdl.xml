<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="nxdlformat.xsl" ?>
<!--
# NeXus - Neutron and X-ray Common Data Format
# 
# Copyright (C) 2014-2016 NeXus International Advisory Committee (NIAC)
# 
# This library is free software; you can redistribute it and/or
# modify it under the terms of the GNU Lesser General Public
# License as published by the Free Software Foundation; either
# version 3 of the License, or (at your option) any later version.
#
# This library is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# Lesser General Public License for more details.
#
# You should have received a copy of the GNU Lesser General Public
# License along with this library; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
#
# For further information, see http://www.nexusformat.org
-->
<definition xmlns="http://definition.nexusformat.org/nxdl/3.1" 
	category="base"
	name="NXtransformations" 
	version="1.0"
	type="group" 
	extends="NXobject"
	ignoreExtraGroups="true"
	ignoreExtraFields="true"
	ignoreExtraAttributes="true"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://definition.nexusformat.org/nxdl/3.1 ../nxdl.xsd"
	>

	<doc>
		Collection of translations and rotations to describe a geometry
		
		A sequence of transformations lists the offset and rotation steps needed
		to describe the position and orientation of any movable or fixed device.

		This class will usually contain all axes of a sample stage or goniometer.

		The entry point (``depends_on``) will be outside of this class and point to a
		field in here. Following the chain may also require following ``depends_on`` 
		links to transformations outside, for example to a common base table.

		For a chain of three transformations, where :math:`T_1` depends on :math:`T_2`
		and that in turn depends on :math:`T_3`, the final transformation :math:`T_f` is
		
		.. math::

		   T_f = T_3 T_2 T_1

		In explicit terms, the transformations are a subset of affine transformations
		expressed as 4x4 matrices that act on homogeneous coordinates, :math:`w=(x,y,z,1)^T`.

		For rotation and translation,

		  .. math::

		    T_r &amp;= \left( \begin{matrix} R  &amp; o \\
		      0_3 &amp; 1 \end{matrix} \right) \\
		    T_t &amp;= \left( \begin{matrix} I_3  &amp; t + o \\
		      0_3 &amp; 1 \end{matrix} \right)

		where :math:`R` is the usual 3x3 rotation matrix, :math:`o` is an offset vector,
		:math:`0_3` is a row of 3 zeros, :math:`I_3` is the 3x3 identity matrix and
		:math:`t` is the translation vector.

		:math:`o` is given the ``offset`` attribute, :math:`t` is given by the ``vector``
		attribute multiplied by the field value, and :math:`R` is defined as a rotation
		about an axis in the direction of ``vector``, of angle of the field value.
	</doc>
	<!-- see: http://wiki.nexusformat.org/Main_Page/NXdetector_2012_10
		
		This entire explanation is not clear.
		-->

	<field name="TRANSFORMATION" nameType="any" type="NX_NUMBER" maxOccurs="unbounded">
		<doc>
			Units need to be appropriate for translation or rotation
			
			The name of this field is not defined.  The user is free to use any name
			that does not cause confusion.  When using more than one TRANSFORMATION field,
			make sure that each field name is unique in the same group, as required
			by HDF5.
		</doc>
		<attribute name="transformation_type">
			<enumeration>
				<item value="translation" />
				<item value="rotation" />
			</enumeration>
		</attribute>
		<attribute name="vector" type="NX_NUMBER">
			<doc>
				Three values that define the axis for this transformation
			</doc>
		</attribute>
		<attribute name="offset" type="NX_NUMBER">
			<doc>
				A fixed offset applied before the transformation (three vector components).
			</doc>
		</attribute>
		<attribute name="offset_units" type="NX_CHAR">
			<doc>
				Units of the offset.
			</doc>
		</attribute>
		<attribute name="depends_on" type="NX_CHAR">
			<doc>
				Points to the name of the next element in the geometry chain.
			</doc>
		</attribute>
	</field>
</definition>
